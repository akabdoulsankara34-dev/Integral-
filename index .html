<!DOCTYPE html>
<html lang="fr" data-theme="light">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
<meta name="theme-color" content="#1A6B3C"/>
<meta name="description" content="Intégral — Menu Digital Premium, Restaurant Cissin. Découvrez notre carte, passez commande et profitez d'une expérience culinaire unique."/>
<meta name="robots" content="index, follow"/>
<meta name="author" content="Integral Restaurant Bar &amp; Café, Cissin"/>

<!-- Open Graph / Réseaux sociaux -->
<meta property="og:type" content="website"/>
<meta property="og:title" content="Integral Restaurant Bar &amp; Café — Menu Digital"/>
<meta property="og:description" content="Découvrez le menu digital du Integral Restaurant Bar &amp; Café à Cissin. Commandez facilement depuis votre table."/>
<meta property="og:locale" content="fr_FR"/>

<!-- PWA -->
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<meta name="apple-mobile-web-app-title" content="Integral Restaurant Bar &amp; Café"/>
<meta name="mobile-web-app-capable" content="yes"/>

<title>Integral Restaurant Bar &amp; Café — Menu Digital</title>
<link rel="manifest" href="manifest.json"/>
<link rel="canonical" href="https://integral-menu.vercel.app/"/>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;0,700;1,400&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js" defer></script>

<!-- ══ FIREBASE SDK ══════════════════════════════════════ -->
<!--
  ⚙️  CONFIGURATION FIREBASE — NOUVEAU PROJET (europe-west1 / Belgique)
  ════════════════════════════════════════════════════════════════════
  ÉTAPES DE CRÉATION DU NOUVEAU PROJET :
  1. Allez sur https://console.firebase.google.com
  2. Cliquez "Ajouter un projet" → donnez un nom (ex: integral-menu)
  3. Dans Firestore → "Créer une base de données"
     → Choisissez "europe-west1 (Belgique)" ← IMPORTANT
     → Mode Production ou Test
  4. Copiez la config ci-dessous depuis :
     Paramètres projet ⚙️ → Vos applications → SDK
  5. Collections à créer dans Firestore :
     • menu_overrides  (documents avec ID = clé du plat)
     • orders          (commandes des clients)
  ════════════════════════════════════════════════════════════════════
-->
<script type="module">
  import { initializeApp }    from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getFirestore, collection, getDocs, addDoc, doc, setDoc,
           deleteDoc, onSnapshot, serverTimestamp }
    from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  // ── Remplacez ces valeurs par celles de votre NOUVEAU projet ──
  const firebaseConfig = {
    apiKey:            "AIzaSyCIkeCTeqjAWEFML3rkNQs-NWs1b4Lu5Jg",
    authDomain:        "integral-bar-resto.firebaseapp.com",
    projectId:         "integral-bar-resto",
    storageBucket:     "integral-bar-resto.firebasestorage.app",
    messagingSenderId: "132815548714",
    appId:             "1:132815548714:web:593cd265e440f6dbfdae53"
  };

  const app = initializeApp(firebaseConfig);
  const db  = getFirestore(app);

  // Activer la région europe-west1 pour les nouvelles requêtes
  window.__DB = db;
  window.__fb = { collection, getDocs, addDoc, doc, setDoc,
                  deleteDoc, onSnapshot, serverTimestamp };

  // ── Clé unique par plat ───────────────────────────────────────
  function itemKey(item){
    return (item.cat + '_' + item.nom).replace(/[^a-z0-9]/gi,'_').toLowerCase();
  }

  // ── Applique les overrides sur le MENU en mémoire ────────────
  function applyOverrides(overrides){
    window.MENU.forEach(item => {
      const key = itemKey(item);
      const ov  = overrides[key];
      if(!ov) return;
      if(ov.prix  !== undefined) item.prix  = ov.prix;
      if(ov.img   !== undefined) item.img   = ov.img;
      if(ov.dispo !== undefined) item.dispo = ov.dispo;
    });
    window.renderMenu && window.renderMenu();
    if(document.getElementById('tab-menu')?.style.display !== 'none'){
      window.renderMenuEditor && window.renderMenuEditor();
    }
  }

  // ── Indicateur connexion (point vert/rouge) ───────────────────
  function setFbDot(ok){
    const dot = document.getElementById('fbDot');
    const lbl = document.getElementById('fbLabel');
    if(dot){ dot.classList.toggle('ok', ok); }
    if(lbl){ lbl.textContent = ok ? 'En ligne' : 'Local'; }
  }
  window._setFbDot = setFbDot;

  // ── Écoute temps réel du menu (onSnapshot) ───────────────────
  function startMenuListener(){
    try {
      onSnapshot(collection(db, 'menu_overrides'), snap => {
        const overrides = {};
        snap.forEach(d => { overrides[d.id] = d.data(); });
        window.__overrides = overrides;
        applyOverrides(overrides);
        setFbDot(true);
      }, err => {
        console.warn('Firebase:', err.message);
        window.renderMenu && window.renderMenu();
        setFbDot(false);
      });
    } catch(e){
      console.warn('Firebase local mode:', e.message);
      window.renderMenu && window.renderMenu();
    }
  }

  // ── Sauvegarder un plat (prix / img / dispo) ─────────────────
  window.fbSaveItem = async function(item){
    try {
      const key  = item._key || itemKey(item);
      const data = {};
      if(item.prix  !== undefined) data.prix  = item.prix;
      if(item.img   !== undefined) data.img   = item.img;
      if(item.dispo !== undefined) data.dispo = item.dispo;
      if(item.cat   !== undefined) data.cat   = item.cat;
      if(item.nom   !== undefined) data.nom   = item.nom;
      await setDoc(doc(db, 'menu_overrides', key), data, { merge: true });
      return true;
    } catch(e){ console.error(e); return false; }
  };

  // ── Supprimer un plat personnalisé ───────────────────────────
  window.fbDeleteItem = async function(key){
    try { await deleteDoc(doc(db, 'menu_overrides', key)); return true; }
    catch(e){ console.error(e); return false; }
  };

  // ── Enregistrer une commande ──────────────────────────────────
  window.fbSaveOrder = async function(order){
    try {
      await addDoc(collection(db, 'orders'), {
        ...order, createdAt: serverTimestamp()
      });
      return true;
    } catch(e){ console.error(e); return false; }
  };

  // ── Écouter les commandes en temps réel ──────────────────────
  window.fbListenOrders = function(callback){
    return onSnapshot(collection(db, 'orders'), snap => {
      const orders = [];
      snap.forEach(d => orders.push({ id: d.id, ...d.data() }));
      orders.sort((a,b) => (b.createdAt?.seconds||0) - (a.createdAt?.seconds||0));
      callback(orders);
    });
  };

  // ── Démarrer l'écoute menu au chargement ─────────────────────
  document.addEventListener('DOMContentLoaded', () => {
    setTimeout(startMenuListener, 800);
  });
</script>

<style>
/* ════════════════════════════════════════════════════════
   INTÉGRAL — CSS Premium v3.0
════════════════════════════════════════════════════════ */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  /* Brand */
  --g:#1A6B3C;--g2:#228B4E;--g3:#E8F5EE;--g4:#F0FAF4;
  --gold:#C9A84C;--gold2:#FBF0D6;--gold3:#A07830;
  /* Neutrals */
  --dark:#0D0F0E;--dark2:#1C201E;--mid:#6B7B72;--muted:#9EAE9F;
  --lite:#F5F8F6;--white:#FFFFFF;--border:#DDE8E2;--border2:#C8DDD3;
  /* Semantic */
  --red:#C0392B;--red2:#FDECEA;--blue:#1A4A8A;
  /* Shadows */
  --shadow-sm:0 2px 8px rgba(0,0,0,.06);
  --shadow:0 4px 20px rgba(0,0,0,.08);
  --shadow-lg:0 12px 40px rgba(0,0,0,.12);
  --shadow-card:0 2px 12px rgba(26,107,60,.08);
  /* Radii */
  --r-sm:8px;--r:14px;--r-lg:20px;--r-xl:28px;
  /* Transitions */
  --t:.22s cubic-bezier(.4,0,.2,1);
}

[data-theme="dark"]{
  --dark:#F0F4F2;--dark2:#E0EBE5;--mid:#A8BDB1;--muted:#6B7B72;
  --lite:#0F1512;--white:#171E1A;--border:#2A3832;--border2:#364840;
  --g3:#1A2B22;--g4:#162019;--gold2:#2A2015;
  --shadow-sm:0 2px 8px rgba(0,0,0,.3);
  --shadow:0 4px 20px rgba(0,0,0,.35);
  --shadow-lg:0 12px 40px rgba(0,0,0,.45);
  --shadow-card:0 2px 12px rgba(0,0,0,.25);
}

html{scroll-behavior:smooth}
body{font-family:'DM Sans',sans-serif;background:var(--lite);color:var(--dark);min-height:100vh;transition:background var(--t),color var(--t)}

/* ── LOADER ──────────────────────────────────── */
#loader{position:fixed;inset:0;background:var(--g);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999;transition:opacity .7s ease,visibility .7s ease}
#loader.hide{opacity:0;visibility:hidden;pointer-events:none}
.loader-logo{font-family:'Cormorant Garamond',serif;color:#fff;font-size:3.2rem;letter-spacing:3px;font-weight:700}
.loader-logo span{color:var(--gold)}
.loader-sub{color:rgba(255,255,255,.55);font-size:.72rem;letter-spacing:4px;text-transform:uppercase;margin-top:6px}
.loader-bar{width:200px;height:2px;background:rgba(255,255,255,.2);border-radius:10px;margin-top:36px;overflow:hidden}
.loader-fill{height:100%;background:linear-gradient(90deg,var(--gold),#F5E690);animation:lf 1.6s cubic-bezier(.4,0,.2,1) forwards}
@keyframes lf{from{width:0}to{width:100%}}
.loader-dots{display:flex;gap:6px;margin-top:20px}
.loader-dot{width:5px;height:5px;border-radius:50%;background:rgba(255,255,255,.35);animation:ld 1.2s ease infinite}
.loader-dot:nth-child(2){animation-delay:.2s}
.loader-dot:nth-child(3){animation-delay:.4s}
@keyframes ld{0%,60%,100%{transform:scale(.8);opacity:.35}30%{transform:scale(1.2);opacity:1}}

/* ── TABLE BANNER ────────────────────────────── */
#tableBanner{background:linear-gradient(90deg,var(--gold),#E8C050);color:var(--dark);text-align:center;padding:9px 16px;font-size:.8rem;font-weight:600;letter-spacing:.4px;display:none}
#tableBanner.show{display:block}

/* ── TOP BAR ─────────────────────────────────── */
#topbar{background:var(--dark2);backdrop-filter:blur(10px);color:#fff;display:flex;align-items:center;justify-content:space-between;padding:0 20px;height:56px;position:sticky;top:0;z-index:500;box-shadow:0 2px 12px rgba(0,0,0,.15)}
[data-theme="dark"] #topbar{background:rgba(15,21,18,.96)}
.topbar-brand{display:flex;align-items:center;gap:10px;text-decoration:none;color:inherit}
.brand-mark{width:34px;height:34px;background:linear-gradient(135deg,var(--g),var(--g2));border-radius:9px;display:flex;align-items:center;justify-content:center}
.brand-mark svg{width:18px;height:18px;fill:#fff}
.brand-name{font-family:'Cormorant Garamond',serif;font-size:1.1rem;letter-spacing:.8px;font-weight:700}
.brand-name em{color:var(--gold);font-style:normal}
.topbar-actions{display:flex;gap:8px;align-items:center}
.btn-icon{background:rgba(255,255,255,.09);border:1.5px solid rgba(255,255,255,.12);color:#fff;width:38px;height:38px;border-radius:10px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:var(--t);position:relative;flex-shrink:0}
.btn-icon:hover{background:var(--g);border-color:var(--g)}
.btn-icon svg{width:18px;height:18px;fill:currentColor}
/* ── Panier : bouton bien visible ── */
.btn-cart{background:linear-gradient(135deg,var(--gold),#E8C050) !important;border-color:var(--gold) !important;color:var(--dark) !important;width:44px !important;height:44px !important;border-radius:12px !important;box-shadow:0 4px 14px rgba(201,168,76,.45)}
.btn-cart:hover{background:linear-gradient(135deg,#E8C050,var(--gold)) !important;transform:translateY(-1px);box-shadow:0 6px 20px rgba(201,168,76,.55)}
.btn-cart svg{width:20px !important;height:20px !important;fill:var(--dark) !important}
.cart-badge{position:absolute;top:-6px;right:-6px;background:#E53935;color:#fff;font-size:.58rem;font-weight:800;width:19px;height:19px;border-radius:50%;display:none;align-items:center;justify-content:center;border:2px solid var(--dark2);box-shadow:0 2px 6px rgba(229,57,53,.5)}
.cart-badge.show{display:flex}
.fb-pill{display:inline-flex;align-items:center;gap:5px;font-size:.68rem;font-weight:500;padding:4px 10px;border-radius:20px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.1);color:rgba(255,255,255,.65)}
.fb-dot{width:7px;height:7px;border-radius:50%;background:#ff6b6b;transition:var(--t)}
.fb-dot.ok{background:#51cf66}

/* ── HERO ────────────────────────────────────── */
#hero{background:linear-gradient(150deg,#0D3320 0%,var(--g) 50%,#1D8A50 100%);padding:70px 24px 44px;text-align:center;position:relative;overflow:hidden;height:56.25vw;min-height:420px;max-height:680px;display:flex;flex-direction:column;align-items:center;justify-content:center}
.hero-bg-pattern{position:absolute;inset:0;opacity:.04;background-image:radial-gradient(circle,#fff 1px,transparent 1px);background-size:30px 30px}
.hero-orb{position:absolute;border-radius:50%;filter:blur(60px);pointer-events:none}
.hero-orb-1{top:-80px;right:-80px;width:300px;height:300px;background:rgba(201,168,76,.18)}
.hero-orb-2{bottom:-60px;left:-60px;width:240px;height:240px;background:rgba(46,125,82,.35)}
#hero h1{font-family:'Cormorant Garamond',serif;color:#fff;font-size:clamp(2rem,7vw,3.4rem);position:relative;z-index:1;line-height:1.15}
#hero h1 em{color:var(--gold);font-style:italic}
#hero p{color:rgba(255,255,255,.6);font-size:.78rem;letter-spacing:3.5px;text-transform:uppercase;margin-top:8px;position:relative;z-index:1}
.hero-divider{width:50px;height:2px;background:linear-gradient(90deg,transparent,var(--gold),transparent);margin:18px auto;position:relative;z-index:1}
.hero-tags{display:flex;gap:8px;justify-content:center;flex-wrap:wrap;position:relative;z-index:1}
.hero-tag{background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.2);color:rgba(255,255,255,.9);padding:6px 14px;border-radius:30px;font-size:.72rem;font-weight:500;backdrop-filter:blur(4px);display:flex;align-items:center;gap:5px}
.hero-location-btn{display:inline-flex;align-items:center;gap:8px;margin-top:18px;background:linear-gradient(135deg,var(--gold),#E8C050);color:var(--dark);font-family:'DM Sans',sans-serif;font-size:.78rem;font-weight:700;padding:10px 20px;border-radius:30px;border:none;cursor:pointer;text-decoration:none;box-shadow:0 4px 16px rgba(201,168,76,.4);transition:var(--t);position:relative;z-index:1;letter-spacing:.3px}
.hero-location-btn:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(201,168,76,.5);background:linear-gradient(135deg,#E8C050,var(--gold))}
.hero-location-btn svg{width:15px;height:15px;fill:currentColor;flex-shrink:0}
.hero-location-btn .loc-pulse{width:8px;height:8px;background:#E53935;border-radius:50%;flex-shrink:0;animation:locPulse 1.5s ease-in-out infinite;box-shadow:0 0 0 0 rgba(229,57,53,.4)}
@keyframes locPulse{0%{box-shadow:0 0 0 0 rgba(229,57,53,.4)}70%{box-shadow:0 0 0 7px rgba(229,57,53,0)}100%{box-shadow:0 0 0 0 rgba(229,57,53,0)}}

/* ── HERO SLIDESHOW ──────────────────────────── */
.hero-slideshow{position:absolute;inset:0;z-index:0;overflow:hidden}
.hero-slide{position:absolute;inset:0;background-size:cover;background-position:center 40%;opacity:0;transition:opacity 1.2s ease;will-change:opacity}
.hero-slide.active{opacity:1}
.hero-slideshow::after{content:'';position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.35) 0%,rgba(0,0,0,.15) 50%,rgba(0,0,0,.50) 100%);z-index:1;pointer-events:none}
#hero .hero-bg-pattern,#hero .hero-orb,#hero > img,#hero h1,#hero p,
#hero .hero-divider,#hero .hero-tags,#hero .hero-location-btn{position:relative;z-index:2}
.hero-dots{display:flex;gap:6px;justify-content:center;margin-top:14px;position:relative;z-index:2}
.hero-dot{width:7px;height:7px;border-radius:50%;background:rgba(255,255,255,.35);border:none;cursor:pointer;padding:0;transition:all .3s ease}
.hero-dot.active{background:var(--gold);width:22px;border-radius:4px}

/* ── BOUTON EXPLORER ─────────────────────────── */
.hero-explore-wrap{position:absolute;top:16px;left:50%;transform:translateX(-50%);z-index:10;display:flex;flex-direction:column;align-items:center;width:calc(100% - 32px);max-width:700px}
.hero-explore-btn{
  display:inline-flex;align-items:center;gap:8px;
  background:rgba(255,255,255,.13);
  border:1.5px solid rgba(255,255,255,.32);
  color:#fff;
  font-family:'DM Sans',sans-serif;font-size:.74rem;font-weight:600;
  padding:9px 22px;border-radius:30px;
  cursor:pointer;
  backdrop-filter:blur(8px);
  transition:all .25s cubic-bezier(.4,0,.2,1);
  letter-spacing:.5px;text-transform:uppercase;
  box-shadow:0 2px 16px rgba(0,0,0,.18);
}
.hero-explore-btn:hover{background:rgba(255,255,255,.22);border-color:var(--gold);transform:translateY(-1px);box-shadow:0 6px 24px rgba(0,0,0,.25)}
.hero-explore-btn.open{background:rgba(201,168,76,.2);border-color:var(--gold);box-shadow:0 4px 20px rgba(201,168,76,.3)}
.hero-explore-btn .e-icon{width:15px;height:15px;fill:var(--gold);transition:transform .3s ease;flex-shrink:0}
.hero-explore-btn.open .e-icon{transform:rotate(180deg)}
.hero-explore-btn .e-dot{width:6px;height:6px;background:var(--gold);border-radius:50%;animation:eDot 2s ease-in-out infinite;flex-shrink:0}
@keyframes eDot{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.45;transform:scale(.65)}}

/* ── PANNEAU QUICK-NAV ───────────────────────── */
#quickNavPanel{
  width:calc(100% - 0px);max-width:700px;
  background:rgba(6,22,13,.9);
  border:1px solid rgba(255,255,255,.14);
  border-radius:20px;
  backdrop-filter:blur(22px);
  overflow:hidden;
  max-height:0;opacity:0;
  transition:max-height .45s cubic-bezier(.4,0,.2,1),opacity .3s ease,margin .35s ease;
  box-shadow:0 24px 60px rgba(0,0,0,.5);
  margin-top:0;
}
#quickNavPanel.open{max-height:80vh;opacity:1;margin-top:10px;overflow-y:auto}
.qnp-header{padding:13px 18px 11px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid rgba(255,255,255,.08)}
.qnp-title{font-family:'Cormorant Garamond',serif;color:#fff;font-size:1.05rem;font-weight:700;display:flex;align-items:center;gap:8px}
.qnp-title svg{width:16px;height:16px;fill:var(--gold)}
.qnp-close{background:rgba(255,255,255,.09);border:none;color:rgba(255,255,255,.65);width:28px;height:28px;border-radius:8px;cursor:pointer;font-size:.85rem;display:flex;align-items:center;justify-content:center;transition:var(--t)}
.qnp-close:hover{background:rgba(255,255,255,.2);color:#fff}
.qnp-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(148px,1fr));gap:7px;padding:13px 14px 16px}
.qnp-chip{
  display:flex;align-items:center;gap:8px;padding:10px 13px;
  background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.1);
  border-radius:12px;cursor:pointer;
  transition:all .2s ease;
  color:rgba(255,255,255,.85);font-size:.75rem;font-weight:500;
  text-align:left;font-family:'DM Sans',sans-serif;white-space:nowrap;
}
.qnp-chip:hover{background:rgba(201,168,76,.2);border-color:rgba(201,168,76,.48);color:#fff;transform:translateY(-2px);box-shadow:0 6px 16px rgba(0,0,0,.3)}
.qnp-chip:active{transform:translateY(0)}
.qnp-chip-emoji{font-size:.95rem;flex-shrink:0;line-height:1}
.qnp-chip-label{flex:1;overflow:hidden;text-overflow:ellipsis}
.qnp-chip-count{font-size:.63rem;color:rgba(201,168,76,.9);background:rgba(201,168,76,.13);padding:2px 6px;border-radius:7px;flex-shrink:0;font-weight:700}
#qnpOverlay{display:none;position:fixed;inset:0;z-index:9}
#qnpOverlay.show{display:block}

/* ── NAV TABS ────────────────────────────────── */
#navWrapper{background:var(--white);border-bottom:1px solid var(--border);position:sticky;top:56px;z-index:400;box-shadow:0 2px 8px rgba(0,0,0,.04)}
#nav{overflow-x:auto;white-space:nowrap;scrollbar-width:none;display:flex;padding:0 16px}
#nav::-webkit-scrollbar{display:none}
.ntab{display:inline-flex;align-items:center;gap:6px;padding:14px 14px;font-size:.73rem;font-weight:500;color:var(--mid);cursor:pointer;border-bottom:2.5px solid transparent;transition:var(--t);text-transform:uppercase;letter-spacing:.6px;white-space:nowrap;user-select:none}
.ntab:hover{color:var(--g)}
.ntab.active{color:var(--g);border-bottom-color:var(--g);font-weight:600}
.ntab-icon{width:20px;height:20px;object-fit:cover;border-radius:4px}

/* ── SEARCH ──────────────────────────────────── */
.search-bar{padding:20px 16px 0;max-width:1280px;margin:0 auto}
.search-wrap{position:relative}
.search-icon{position:absolute;left:16px;top:50%;transform:translateY(-50%);color:var(--muted)}
.search-icon svg{width:17px;height:17px}
.search-input{width:100%;border:2px solid var(--border);border-radius:40px;padding:12px 22px 12px 44px;font-size:.88rem;font-family:'DM Sans',sans-serif;outline:none;transition:var(--t);background:var(--white);color:var(--dark);box-shadow:var(--shadow-sm)}
.search-input:focus{border-color:var(--g);box-shadow:0 0 0 4px rgba(26,107,60,.08)}
.search-input::placeholder{color:var(--muted)}

/* ── MAIN ────────────────────────────────────── */
main{max-width:1280px;margin:0 auto;padding:0 16px 120px}
.section{padding-top:52px;animation:fadeUp .4s ease both}
@keyframes fadeUp{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:none}}
.section-head{display:flex;align-items:center;gap:14px;margin-bottom:24px}
.section-accent{width:4px;height:38px;background:linear-gradient(180deg,var(--gold),var(--g));border-radius:4px;flex-shrink:0}
.section-title{font-family:'Cormorant Garamond',serif;font-size:1.9rem;color:var(--dark);font-weight:700;line-height:1}
.section-count{font-size:.72rem;color:var(--muted);background:var(--g3);padding:3px 9px;border-radius:20px;font-weight:500;margin-left:4px;align-self:flex-end;margin-bottom:4px}

/* ── GRID ────────────────────────────────────── */
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px}

/* ── CARD ────────────────────────────────────── */
.card{background:var(--white);border-radius:var(--r);overflow:hidden;box-shadow:var(--shadow-card);transition:transform var(--t),box-shadow var(--t);display:flex;flex-direction:column;border:1px solid var(--border);position:relative}
.card:hover{transform:translateY(-5px);box-shadow:0 16px 40px rgba(26,107,60,.14)}
.card.unavailable{opacity:.5;pointer-events:none}
.card-img-wrap{position:relative;overflow:hidden;aspect-ratio:4/3}
.card-img{width:100%;height:100%;object-fit:cover;background:var(--g3);display:block;transition:transform .4s ease}
.card:hover .card-img{transform:scale(1.05)}
.card-img-fallback{width:100%;height:100%;background:linear-gradient(135deg,var(--g3),#C8E8D0);display:flex;align-items:center;justify-content:center;aspect-ratio:4/3}
.card-img-fallback img{width:56px;height:56px;object-fit:contain;opacity:.5}
.card-unavail-badge{position:absolute;top:10px;left:10px;background:rgba(192,57,43,.9);color:#fff;font-size:.64rem;font-weight:700;padding:3px 9px;border-radius:20px;letter-spacing:.4px;text-transform:uppercase}
.card-body{padding:14px 14px 15px;flex:1;display:flex;flex-direction:column;gap:9px}
.card-name{font-weight:600;font-size:.9rem;line-height:1.4;color:var(--dark)}
.card-bottom{display:flex;align-items:center;justify-content:space-between;margin-top:auto}
.card-price{font-family:'Cormorant Garamond',serif;font-size:1.12rem;color:var(--g);font-weight:700}
.card-price-variable{font-size:.72rem;color:var(--muted);font-family:'DM Sans',sans-serif;font-weight:400}
.btn-add{background:var(--g);color:#fff;border:none;width:32px;height:32px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:var(--t);flex-shrink:0;box-shadow:0 2px 8px rgba(26,107,60,.3)}
.btn-add svg{width:15px;height:15px;fill:currentColor}
.btn-add:hover{background:var(--g2);transform:scale(1.1);box-shadow:0 4px 14px rgba(26,107,60,.4)}
.btn-add:active{transform:scale(.95)}
.card-qty-ctrl{display:flex;align-items:center;gap:5px}
.card-qty-ctrl button{width:28px;height:28px;border-radius:50%;border:1.5px solid var(--border);background:var(--white);color:var(--dark);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:1rem;font-weight:600;transition:var(--t)}
.card-qty-ctrl button:hover{background:var(--g);color:#fff;border-color:var(--g)}
.card-qty-ctrl span{font-size:.88rem;font-weight:700;min-width:18px;text-align:center;color:var(--g)}

/* ── PANIER DRAWER ───────────────────────────── */
#cartOverlay{position:fixed;inset:0;background:rgba(0,0,0,.55);z-index:800;opacity:0;pointer-events:none;transition:opacity var(--t);backdrop-filter:blur(3px)}
#cartOverlay.open{opacity:1;pointer-events:all}
#cartDrawer{position:fixed;right:-100%;top:0;bottom:0;width:min(440px,100%);background:var(--white);z-index:801;transition:right .35s cubic-bezier(.4,0,.2,1);display:flex;flex-direction:column;box-shadow:-8px 0 40px rgba(0,0,0,.18)}
#cartDrawer.open{right:0}
.drawer-head{background:linear-gradient(135deg,var(--dark2),#2A3830);color:#fff;padding:20px 20px;display:flex;align-items:center;justify-content:space-between;flex-shrink:0}
.drawer-head-title{display:flex;align-items:center;gap:10px}
.drawer-head-title svg{width:20px;height:20px;fill:currentColor;opacity:.8}
.drawer-head h3{font-family:'Cormorant Garamond',serif;font-size:1.3rem;font-weight:700}
.drawer-head small{font-size:.72rem;opacity:.55;display:block;margin-top:2px;font-family:'DM Sans',sans-serif}
.btn-close{background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.15);color:#fff;width:34px;height:34px;border-radius:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:var(--t);font-size:1rem}
.btn-close:hover{background:rgba(255,255,255,.2)}
#cartItems{flex:1;overflow-y:auto;padding:14px;scrollbar-width:thin;scrollbar-color:var(--border) transparent}
.cart-empty{text-align:center;color:var(--muted);padding:52px 16px;font-size:.88rem}
.cart-empty svg{width:48px;height:48px;fill:var(--border);margin-bottom:12px;display:block;margin-left:auto;margin-right:auto}
.cart-item{display:flex;align-items:center;gap:10px;padding:12px 0;border-bottom:1px solid var(--border);animation:fadeUp .25s ease both}
.ci-thumb{width:44px;height:44px;border-radius:9px;object-fit:cover;background:var(--g3);flex-shrink:0;border:1px solid var(--border)}
.ci-info{flex:1;min-width:0}
.ci-name{font-size:.85rem;font-weight:600;color:var(--dark);line-height:1.3;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.ci-unit-price{font-size:.72rem;color:var(--muted);margin-top:2px}
.ci-qty-row{display:flex;align-items:center;gap:6px;margin-top:6px}
.ciq-btn{width:24px;height:24px;border-radius:50%;border:1px solid var(--border);background:var(--white);color:var(--dark);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:.82rem;font-weight:700;transition:var(--t)}
.ciq-btn:hover{background:var(--g);color:#fff;border-color:var(--g)}
.ciq-val{font-size:.85rem;font-weight:700;min-width:18px;text-align:center;color:var(--dark)}
.ci-price{font-family:'Cormorant Garamond',serif;font-size:1rem;color:var(--g);font-weight:700;flex-shrink:0}
.btn-rm{background:none;border:none;color:var(--border2);cursor:pointer;padding:4px;border-radius:5px;transition:var(--t);display:flex;align-items:center;justify-content:center}
.btn-rm:hover{color:var(--red);background:var(--red2)}
.btn-rm svg{width:14px;height:14px;fill:currentColor}
.drawer-footer{padding:16px;border-top:1px solid var(--border);background:var(--lite);flex-shrink:0}
.cart-total-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
.cart-total-row span{font-weight:500;font-size:.85rem;color:var(--mid)}
.cart-total-row strong{font-family:'Cormorant Garamond',serif;font-size:1.7rem;color:var(--g);font-weight:700}
.cart-note{width:100%;border:1.5px solid var(--border);border-radius:10px;padding:10px 13px;font-family:'DM Sans',sans-serif;font-size:.82rem;resize:none;outline:none;margin-bottom:12px;background:var(--white);color:var(--dark);transition:var(--t)}
.cart-note:focus{border-color:var(--g)}
.btn-wa{width:100%;background:linear-gradient(135deg,#25D366,#1EB855);color:#fff;border:none;border-radius:12px;padding:14px;font-size:.92rem;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;transition:var(--t);font-family:'DM Sans',sans-serif;box-shadow:0 4px 16px rgba(37,211,102,.3)}
.btn-wa:hover{transform:translateY(-1px);box-shadow:0 6px 20px rgba(37,211,102,.4)}
.btn-wa svg{width:20px;height:20px;fill:currentColor;flex-shrink:0}
.cart-secondary-btns{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:9px}
.btn-secondary{border:1.5px solid var(--border);border-radius:10px;padding:10px;font-size:.78rem;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:7px;transition:var(--t);font-family:'DM Sans',sans-serif;background:var(--white);color:var(--dark)}
.btn-secondary:hover{border-color:var(--g);color:var(--g)}
.btn-secondary svg{width:15px;height:15px;fill:currentColor}

/* ── ADMIN MODAL ─────────────────────────────── */
#adminModal{position:fixed;inset:0;background:rgba(0,0,0,.72);z-index:900;display:none;align-items:center;justify-content:center;padding:14px;backdrop-filter:blur(4px)}
#adminModal.open{display:flex}
#adminModal.fullscreen{padding:0}
#adminModal.fullscreen .modal-box{max-width:100%;max-height:100vh;height:100vh;border-radius:0}
.modal-box{background:var(--white);border-radius:22px;width:100%;max-width:980px;max-height:92vh;overflow:hidden;display:flex;flex-direction:column;box-shadow:0 32px 80px rgba(0,0,0,.3);animation:modalIn .3s cubic-bezier(.4,0,.2,1)}
@keyframes modalIn{from{opacity:0;transform:scale(.96) translateY(10px)}to{opacity:1;transform:none}}
.modal-head{background:linear-gradient(135deg,var(--dark2),#2A3830);color:#fff;padding:18px 22px;display:flex;align-items:center;justify-content:space-between;flex-shrink:0}
.modal-head h3{font-family:'Cormorant Garamond',serif;font-size:1.3rem;font-weight:700}
.modal-head-btns{display:flex;align-items:center;gap:8px}
.btn-expand{background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.15);color:#fff;width:32px;height:32px;border-radius:7px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:var(--t);font-size:.9rem}
.btn-expand:hover{background:rgba(255,255,255,.25)}
.modal-body{flex:1;overflow-y:auto;padding:22px;scrollbar-width:thin;scrollbar-color:var(--border) transparent}

/* login */
#loginBox{max-width:320px;margin:28px auto;text-align:center}
#loginBox h4{font-family:'Cormorant Garamond',serif;font-size:1.6rem;margin-bottom:8px;color:var(--g);font-weight:700}
#loginBox p{font-size:.78rem;color:var(--muted);margin-bottom:22px}
.fg{margin-bottom:13px;text-align:left}
.fg label{font-size:.72rem;font-weight:700;color:var(--mid);display:block;margin-bottom:5px;text-transform:uppercase;letter-spacing:.6px}
.fg input,.fg select{width:100%;border:2px solid var(--border);border-radius:10px;padding:11px 14px;font-family:'DM Sans',sans-serif;font-size:.88rem;outline:none;transition:var(--t);background:var(--white);color:var(--dark)}
.fg input:focus,.fg select:focus{border-color:var(--g);box-shadow:0 0 0 4px rgba(26,107,60,.08)}
.btn-primary{background:linear-gradient(135deg,var(--g),var(--g2));color:#fff;border:none;border-radius:10px;padding:12px 20px;font-size:.92rem;font-weight:700;cursor:pointer;width:100%;font-family:'DM Sans',sans-serif;transition:var(--t);box-shadow:0 4px 14px rgba(26,107,60,.25)}
.btn-primary:hover{transform:translateY(-1px);box-shadow:0 6px 20px rgba(26,107,60,.35)}
.login-err{color:var(--red);font-size:.78rem;margin-top:9px;display:none;background:var(--red2);padding:8px 12px;border-radius:8px}

/* admin tabs */
.admin-tabs{display:flex;gap:2px;margin-bottom:22px;border-bottom:2px solid var(--border);overflow-x:auto;scrollbar-width:none}
.admin-tabs::-webkit-scrollbar{display:none}
.atab{padding:9px 16px;font-size:.78rem;font-weight:600;color:var(--mid);cursor:pointer;border-bottom:3px solid transparent;margin-bottom:-2px;transition:var(--t);white-space:nowrap;display:flex;align-items:center;gap:6px}
.atab.active{color:var(--g);border-bottom-color:var(--g)}
.atab svg{width:15px;height:15px;fill:currentColor}

/* stats */
.stats-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(155px,1fr));gap:13px;margin-bottom:22px}
.stat-card{background:var(--lite);border-radius:14px;padding:18px;border-left:4px solid var(--g);transition:var(--t)}
.stat-card:hover{transform:translateY(-2px);box-shadow:var(--shadow-sm)}
.stat-val{font-family:'Cormorant Garamond',serif;font-size:2.1rem;font-weight:700;color:var(--g);line-height:1}
.stat-label{font-size:.7rem;color:var(--mid);text-transform:uppercase;letter-spacing:.5px;margin-top:5px}
.stat-card.gold{border-left-color:var(--gold)}.stat-card.gold .stat-val{color:var(--gold3)}
.stat-card.blue{border-left-color:var(--blue)}.stat-card.blue .stat-val{color:var(--blue)}
.chart-wrap{background:var(--lite);border-radius:14px;padding:18px;margin-bottom:16px}
.chart-title{font-weight:700;font-size:.78rem;margin-bottom:14px;color:var(--mid);text-transform:uppercase;letter-spacing:.5px}
.bar-row{display:flex;align-items:center;gap:10px;margin-bottom:9px}
.bar-label{font-size:.76rem;width:140px;flex-shrink:0;color:var(--mid);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.bar-track{flex:1;background:var(--border);border-radius:6px;height:18px;overflow:hidden}
.bar-fill{height:100%;background:var(--g);border-radius:6px;display:flex;align-items:center;justify-content:flex-end;padding-right:8px;font-size:.7rem;color:#fff;font-weight:700;transition:width .7s cubic-bezier(.4,0,.2,1)}
.bar-fill.gold{background:var(--gold)}

/* orders table */
.orders-table{width:100%;border-collapse:collapse;font-size:.8rem}
.orders-table th{background:var(--dark2);color:#fff;padding:10px 12px;text-align:left;font-weight:600;font-size:.74rem;text-transform:uppercase;letter-spacing:.4px}
.orders-table th:first-child{border-radius:8px 0 0 0}
.orders-table th:last-child{border-radius:0 8px 0 0}
.orders-table td{padding:10px 12px;border-bottom:1px solid var(--border);vertical-align:top;color:var(--dark)}
.orders-table tr:hover td{background:var(--g4)}
.badge{display:inline-block;padding:3px 9px;border-radius:20px;font-size:.68rem;font-weight:700;text-transform:uppercase;letter-spacing:.3px}
.badge.green{background:#d4edda;color:#155724}
.badge.orange{background:#fff3cd;color:#856404}
.badge.red{background:#f8d7da;color:#721c24}

/* menu editor */
.me-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:10px}
.me-item{display:flex;align-items:center;gap:11px;padding:11px 13px;border:1.5px solid var(--border);border-radius:12px;background:var(--white);transition:var(--t)}
.me-item:hover{border-color:var(--g);box-shadow:var(--shadow-sm)}
.me-thumb{width:46px;height:46px;border-radius:9px;object-fit:cover;background:var(--g3);flex-shrink:0;border:1px solid var(--border)}
.me-info{flex:1;min-width:0}
.me-name{font-size:.85rem;font-weight:600;color:var(--dark);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.me-cat{font-size:.7rem;color:var(--muted);margin-top:2px}
.me-price{font-size:.82rem;color:var(--g);font-weight:700;white-space:nowrap}
.me-actions{display:flex;gap:5px;flex-shrink:0}
.btn-sm{padding:5px 11px;border-radius:7px;font-size:.72rem;font-weight:700;cursor:pointer;border:none;font-family:'DM Sans',sans-serif;transition:var(--t);display:flex;align-items:center;gap:4px}
.btn-sm svg{width:12px;height:12px;fill:currentColor}
.btn-edit{background:var(--g3);color:var(--g)}.btn-edit:hover{background:var(--g);color:#fff}
.btn-del{background:var(--red2);color:var(--red)}.btn-del:hover{background:var(--red);color:#fff}
.btn-add-item{background:linear-gradient(135deg,var(--g),var(--g2));color:#fff;border:none;border-radius:10px;padding:10px 18px;font-size:.82rem;font-weight:700;cursor:pointer;font-family:'DM Sans',sans-serif;margin-bottom:16px;display:inline-flex;align-items:center;gap:7px;box-shadow:0 4px 12px rgba(26,107,60,.25)}

/* edit form */
.edit-form{background:var(--g4);border:1.5px solid var(--border);border-radius:14px;padding:18px;margin-bottom:16px;display:none;animation:fadeUp .2s ease}
.edit-form.show{display:block}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.form-row-3{display:grid;grid-template-columns:2fr 1fr 1fr;gap:12px}
.img-preview{width:100%;height:90px;border-radius:9px;object-fit:cover;margin-top:7px;display:none;border:1px solid var(--border)}
.img-preview.show{display:block}
.toggle-dispo{display:flex;align-items:center;gap:9px;font-size:.82rem;color:var(--mid);margin-top:10px;cursor:pointer}
.toggle-switch{width:36px;height:20px;background:var(--border2);border-radius:20px;position:relative;transition:var(--t);cursor:pointer}
.toggle-switch::after{content:'';position:absolute;width:14px;height:14px;background:#fff;border-radius:50%;top:3px;left:3px;transition:var(--t);box-shadow:0 1px 3px rgba(0,0,0,.2)}
.toggle-switch.active{background:var(--g)}
.toggle-switch.active::after{left:19px}

/* config */
.config-section{margin-bottom:24px;padding-bottom:20px;border-bottom:1px solid var(--border)}
.config-section:last-child{border-bottom:none}
.config-section h5{font-size:.78rem;text-transform:uppercase;letter-spacing:.6px;color:var(--mid);font-weight:700;margin-bottom:14px;display:flex;align-items:center;gap:7px}
.config-section h5 svg{width:14px;height:14px;fill:currentColor}

/* toast */
#toast{position:fixed;bottom:28px;left:50%;transform:translateX(-50%) translateY(100px);background:var(--dark2);color:#fff;padding:12px 24px;border-radius:40px;font-size:.84rem;z-index:999;transition:.35s cubic-bezier(.4,0,.2,1);opacity:0;white-space:nowrap;display:flex;align-items:center;gap:8px;box-shadow:0 8px 24px rgba(0,0,0,.25);font-weight:500;max-width:90vw}
#toast.show{transform:translateX(-50%) translateY(0);opacity:1}
#toast.green{background:linear-gradient(135deg,var(--g),var(--g2))}
#toast.red{background:linear-gradient(135deg,var(--red),#E74C3C)}
#toast.gold{background:linear-gradient(135deg,var(--gold3),var(--gold))}

/* scroll top */
#scrollTop{position:fixed;bottom:28px;right:24px;width:44px;height:44px;background:var(--g);color:#fff;border:none;border-radius:50%;cursor:pointer;opacity:0;transition:var(--t);z-index:300;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 14px rgba(26,107,60,.4)}
#scrollTop.show{opacity:1}
#scrollTop:hover{background:var(--g2);transform:translateY(-2px)}
#scrollTop svg{width:18px;height:18px;fill:currentColor}

.no-result{text-align:center;color:var(--muted);padding:60px;display:none}
.no-result svg{width:52px;height:52px;fill:var(--border);margin-bottom:14px}

/* QR Modal */
#qrModal{position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:850;display:none;align-items:center;justify-content:center;backdrop-filter:blur(4px)}
#qrModal.open{display:flex}
.qr-box{background:var(--white);border-radius:22px;padding:36px;text-align:center;max-width:360px;width:90%;box-shadow:0 32px 80px rgba(0,0,0,.3);animation:modalIn .3s ease}
.qr-box h3{font-family:'Cormorant Garamond',serif;font-size:1.5rem;font-weight:700;margin-bottom:6px;color:var(--dark)}
.qr-box p{font-size:.78rem;color:var(--muted);margin-bottom:20px}
#qrCanvas{margin:0 auto}
.qr-url{font-size:.7rem;color:var(--muted);margin-top:14px;word-break:break-all;background:var(--lite);padding:8px 12px;border-radius:8px;border:1px solid var(--border)}
.qr-close{margin-top:18px;padding:10px 24px;background:var(--g);color:#fff;border:none;border-radius:10px;font-family:'DM Sans',sans-serif;font-size:.85rem;font-weight:700;cursor:pointer;transition:var(--t)}
.qr-close:hover{background:var(--g2)}

/* Print styles */
@media print{
  body *{visibility:hidden}
  #printArea,#printArea *{visibility:visible}
  #printArea{position:fixed;left:0;top:0;width:80mm;font-family:monospace;font-size:10pt;padding:4mm;background:#fff}
  #printArea *{color:#000!important;background:none!important}
}

/* Responsive */
@media(max-width:600px){
  .grid{grid-template-columns:repeat(2,1fr);gap:10px}
  .card-body{padding:10px 11px 12px}
  .card-name{font-size:.82rem}
  .form-row,.form-row-3{grid-template-columns:1fr}
  .me-grid{grid-template-columns:1fr}
  .me-item{flex-wrap:wrap}
  .stats-grid{grid-template-columns:repeat(2,1fr)}
  .cart-secondary-btns{grid-template-columns:1fr}
}
@media(min-width:900px){
  .grid{grid-template-columns:repeat(auto-fill,minmax(240px,1fr))}
}
</style>
</head>
<body>

<!-- HIDDEN PRINT AREA -->
<div id="printArea" style="display:none"></div>

<!-- LOADER -->
<div id="loader">
  <img src="logo.png" alt="Integral Logo" style="width:90px;height:90px;object-fit:contain;margin-bottom:14px;filter:brightness(0) invert(1)"/>
  <div class="loader-logo" style="font-size:1.5rem;letter-spacing:2px">Integral Restaurant Bar<span> & Café</span></div>
  <div class="loader-sub">Menu Digital Premium</div>
  <div class="loader-bar"><div class="loader-fill"></div></div>
  <div class="loader-dots">
    <div class="loader-dot"></div>
    <div class="loader-dot"></div>
    <div class="loader-dot"></div>
  </div>
</div>

<!-- BANNIÈRE TABLE -->
<div id="tableBanner"></div>

<!-- TOP BAR -->
<div id="topbar">
  <div class="topbar-brand">
    <div class="brand-mark" style="background:none;padding:0;width:40px;height:40px;border-radius:0">
      <img src="logo.png" alt="Integral Logo" style="width:40px;height:40px;object-fit:contain"/>
    </div>
    <div class="brand-name" style="font-size:1.1rem;letter-spacing:.8px">Integral <em>Restaurant</em> Bar & Café</div>
  </div>
  <div class="topbar-actions">
    <div class="fb-pill" title="État Firebase">
      <div class="fb-dot" id="fbDot"></div>
      <span id="fbLabel">Firebase</span>
    </div>

    <button class="btn-icon" id="darkToggle" onclick="toggleDark()" title="Mode sombre">
      <svg id="darkIcon" viewBox="0 0 24 24"><path d="M12 3a9 9 0 100 18A9 9 0 0012 3zm0 2a7 7 0 010 14V5z"/></svg>
    </button>
    <button class="btn-icon btn-cart" onclick="openCart()" title="Panier">
      <svg viewBox="0 0 24 24"><path d="M17 18c-1.1 0-1.99.9-1.99 2S15.9 22 17 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96C5 16.1 6.1 17 7 17h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63H19c.75 0 1.41-.41 1.75-1.03l3.58-6.49A1 1 0 0023.45 4H5.21l-.94-2H1zm6 14c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2z"/></svg>
      <span class="cart-badge" id="cartBadge">0</span>
    </button>
    <button class="btn-icon admin-btn-hidden" id="adminBtn" onclick="openAdmin()" title="Administration" style="opacity:0;pointer-events:none;width:0;padding:0;border:none;overflow:hidden;margin:0">
      <svg viewBox="0 0 24 24"><path d="M12 15.5A3.5 3.5 0 018.5 12 3.5 3.5 0 0112 8.5a3.5 3.5 0 013.5 3.5 3.5 3.5 0 01-3.5 3.5m7.43-2.92c.04-.34.07-.69.07-1.08s-.03-.73-.07-1.08l2.31-1.81c.21-.16.27-.44.14-.67l-2.19-3.79c-.14-.23-.41-.3-.64-.21l-2.72 1.09c-.57-.43-1.17-.79-1.83-1.07L14.02 3.1A.517.517 0 0013.5 2.7h-3c-.25 0-.46.18-.5.42L9.66 5.44c-.66.28-1.26.64-1.83 1.07L5.11 5.42c-.24-.09-.5-.01-.64.21L2.28 9.42c-.13.23-.07.51.14.67l2.31 1.81c-.04.35-.07.7-.07 1.08s.03.73.07 1.08L2.42 15.87c-.21.16-.27.44-.14.67l2.19 3.79c.14.23.41.3.64.21l2.72-1.09c.57.43 1.17.79 1.83 1.07l.34 2.33c.04.25.25.43.5.43h3c.25 0 .46-.18.5-.42l.34-2.34c.66-.28 1.26-.64 1.83-1.07l2.72 1.09c.24.09.5.01.64-.21l2.19-3.79c.14-.23.07-.51-.14-.67l-2.31-1.8z"/></svg>
    </button>
  </div>
</div>

<!-- HERO -->
<div id="hero">
  <!-- ══ DIAPORAMA PHOTOS ══
       Remplacez les URL par vos propres photos du restaurant (ex: photo1.jpg) -->
  <div class="hero-slideshow" id="heroSlideshow">
    <div class="hero-slide active" style="background-image:url('https://i.ibb.co/RpxZ0Gnb/IMG-20260225-WA0041-LE-upscale-prime.jpg')"></div>
    <div class="hero-slide" style="background-image:url('https://i.ibb.co/VW63KC42/In-Shot-20260225-193156599-LE-upscale-prime-0.jpg')"></div>
    <div class="hero-slide" style="background-image:url('https://i.ibb.co/WNQwrS8V/In-Shot-20260225-193031543-LE-upscale-prime.jpg')"></div>
    <div class="hero-slide" style="background-image:url('https://i.ibb.co/RJ9Lb7x/upscalemedia-transformed-1.jpg')"></div>
  </div>

  <div class="hero-bg-pattern"></div>
  <div class="hero-orb hero-orb-1"></div>
  <div class="hero-orb hero-orb-2"></div>

  <!-- ══ BOUTON EXPLORER — AU DESSUS DU LOGO ══ -->
  <div class="hero-explore-wrap" id="heroExploreWrap">
    <button class="hero-explore-btn" id="heroExploreBtn" onclick="toggleQuickNav()" aria-expanded="false" aria-controls="quickNavPanel">
      <span class="e-dot"></span>
      <svg class="e-icon" viewBox="0 0 24 24"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
      Explorer le Menu
      <svg class="e-icon" viewBox="0 0 24 24"><path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/></svg>
    </button>

    <!-- ══ PANNEAU QUICK-NAV ══ -->
    <div id="quickNavPanel" role="navigation" aria-label="Catégories du menu">
      <div class="qnp-header">
        <div class="qnp-title">
          <svg viewBox="0 0 24 24"><path d="M11 9H9V2H7v7H5V2H3v7c0 2.12 1.66 3.84 3.75 3.97V22h2.5v-9.03C11.34 12.84 13 11.12 13 9V2h-2v7zm5-3v8h2.5v8H21V2c-2.76 0-5 2.24-5 4z"/></svg>
          Toutes les catégories
        </div>
        <button class="qnp-close" onclick="closeQuickNav()" aria-label="Fermer">✕</button>
      </div>
      <div class="qnp-grid" id="qnpGrid">
        <!-- Généré dynamiquement par JS -->
      </div>
    </div>
  </div>

  <!-- Logo + nom + ville -->
  <img src="logo.png" alt="Integral Logo" style="width:80px;height:80px;object-fit:contain;margin-bottom:12px;position:relative;z-index:1;filter:brightness(0) invert(1)"/>
  <h1>Integral <em>Restaurant</em><br>Bar & Café</h1>
  <p>Ouagadougou · Burkina Faso</p>
  <div class="hero-divider"></div>
  <div class="hero-tags">
    <button class="hero-tag hero-tag-reserve" onclick="openSalonModal()" style="cursor:pointer;border:none;background:linear-gradient(135deg,rgba(201,168,76,.25),rgba(201,168,76,.12));border:1.5px solid rgba(201,168,76,.5);color:#fff;font-family:'DM Sans',sans-serif;font-size:.72rem;font-weight:600;padding:8px 16px;border-radius:30px;display:inline-flex;align-items:center;gap:7px;transition:all .22s ease;backdrop-filter:blur(4px)">
      <svg viewBox="0 0 24 24" style="width:16px;height:16px;fill:var(--gold);flex-shrink:0"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 3c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm7 13H5v-.23c0-.62.28-1.2.76-1.58C7.47 15.82 9.64 15 12 15s4.53.82 6.24 2.19c.48.38.76.97.76 1.58V19z"/></svg>
      Réserver un salon
    </button>
    <span class="hero-tag">
      <img src="https://images.unsplash.com/photo-1544025162-d76694265947?w=40&h=40&fit=crop&q=80" alt="Grillades" style="width:16px;height:16px;border-radius:3px;object-fit:cover"/>
      Grillades
    </span>
    <span class="hero-tag">
      <img src="https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?w=40&h=40&fit=crop&q=80" alt="Café" style="width:16px;height:16px;border-radius:3px;object-fit:cover"/>
      Café & Thés
    </span>
  </div>
  <a class="hero-location-btn"
     href="https://www.google.com/maps?q=12.327382,-1.55043"
     target="_blank" rel="noopener"
     onclick="openInMaps(event)"
     title="Ouvrir dans Google Maps">
    <span class="loc-pulse"></span>
    <svg viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
    Nous trouver — Integral Restaurant Bar & Café
  </a>
  <!-- Points indicateurs diaporama -->
  <div class="hero-dots" id="heroDots">
    <button class="hero-dot active" onclick="goSlide(0)"></button>
    <button class="hero-dot" onclick="goSlide(1)"></button>
    <button class="hero-dot" onclick="goSlide(2)"></button>
    <button class="hero-dot" onclick="goSlide(3)"></button>
  </div>
</div>
<!-- Overlay transparent pour fermer le panel -->
<div id="qnpOverlay" onclick="closeQuickNav()"></div>

<!-- NAV TABS -->
<div id="navWrapper"><div id="nav"></div></div>

<!-- ══ MODAL RÉSERVATION SALON ══════════════════════════════ -->
<div id="salonModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.72);z-index:950;align-items:center;justify-content:center;padding:16px;backdrop-filter:blur(5px)">
  <div style="background:var(--white);border-radius:22px;width:100%;max-width:540px;max-height:92vh;overflow-y:auto;box-shadow:0 32px 80px rgba(0,0,0,.35);animation:modalIn .3s cubic-bezier(.4,0,.2,1)">
    <!-- En-tête -->
    <div style="background:linear-gradient(135deg,var(--dark2),#2A3830);color:#fff;padding:22px 24px;border-radius:22px 22px 0 0;display:flex;align-items:center;justify-content:space-between">
      <div>
        <h3 style="font-family:'Cormorant Garamond',serif;font-size:1.5rem;font-weight:700;display:flex;align-items:center;gap:10px">
          <svg viewBox="0 0 24 24" style="width:22px;height:22px;fill:var(--gold)"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 3c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm7 13H5v-.23c0-.62.28-1.2.76-1.58C7.47 15.82 9.64 15 12 15s4.53.82 6.24 2.19c.48.38.76.97.76 1.58V19z"/></svg>
          Réserver un Salon
        </h3>
        <p style="font-size:.74rem;opacity:.55;margin-top:4px;font-family:'DM Sans',sans-serif">Integral Restaurant Bar & Café · Ouagadougou</p>
      </div>
      <button onclick="closeSalonModal()" style="background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.15);color:#fff;width:36px;height:36px;border-radius:9px;cursor:pointer;font-size:1.1rem;display:flex;align-items:center;justify-content:center;transition:var(--t)" onmouseover="this.style.background='rgba(255,255,255,.22)'" onmouseout="this.style.background='rgba(255,255,255,.1)'">✕</button>
    </div>

    <!-- Corps du formulaire -->
    <div style="padding:24px" id="salonFormWrap">
      <!-- Intro -->
      <div style="background:var(--g4);border:1px solid var(--border);border-radius:12px;padding:13px 16px;margin-bottom:20px;display:flex;gap:10px;align-items:flex-start">
        <svg viewBox="0 0 24 24" style="width:18px;height:18px;fill:var(--g);flex-shrink:0;margin-top:2px"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>
        <p style="font-size:.78rem;color:var(--mid);line-height:1.6">Remplissez ce formulaire pour réserver votre salon privé. Nous vous confirmerons votre réservation dans les <strong>24h</strong> par téléphone ou WhatsApp.</p>
      </div>

      <!-- Champs -->
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:14px">
        <div>
          <label style="font-size:.72rem;font-weight:700;color:var(--mid);display:block;margin-bottom:6px;text-transform:uppercase;letter-spacing:.6px">Nom complet *</label>
          <input id="sr-nom" type="text" placeholder="Votre nom" style="width:100%;border:2px solid var(--border);border-radius:10px;padding:11px 13px;font-family:'DM Sans',sans-serif;font-size:.88rem;outline:none;background:var(--white);color:var(--dark);transition:var(--t)" onfocus="this.style.borderColor='var(--g)'" onblur="this.style.borderColor='var(--border)'"/>
        </div>
        <div>
          <label style="font-size:.72rem;font-weight:700;color:var(--mid);display:block;margin-bottom:6px;text-transform:uppercase;letter-spacing:.6px">Téléphone / WhatsApp *</label>
          <input id="sr-tel" type="tel" placeholder="+226 XX XX XX XX" style="width:100%;border:2px solid var(--border);border-radius:10px;padding:11px 13px;font-family:'DM Sans',sans-serif;font-size:.88rem;outline:none;background:var(--white);color:var(--dark);transition:var(--t)" onfocus="this.style.borderColor='var(--g)'" onblur="this.style.borderColor='var(--border)'"/>
        </div>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:14px">
        <div>
          <label style="font-size:.72rem;font-weight:700;color:var(--mid);display:block;margin-bottom:6px;text-transform:uppercase;letter-spacing:.6px">Date souhaitée *</label>
          <input id="sr-date" type="date" style="width:100%;border:2px solid var(--border);border-radius:10px;padding:11px 13px;font-family:'DM Sans',sans-serif;font-size:.88rem;outline:none;background:var(--white);color:var(--dark);transition:var(--t)" onfocus="this.style.borderColor='var(--g)'" onblur="this.style.borderColor='var(--border)'"/>
        </div>
        <div>
          <label style="font-size:.72rem;font-weight:700;color:var(--mid);display:block;margin-bottom:6px;text-transform:uppercase;letter-spacing:.6px">Heure souhaitée *</label>
          <input id="sr-heure" type="time" style="width:100%;border:2px solid var(--border);border-radius:10px;padding:11px 13px;font-family:'DM Sans',sans-serif;font-size:.88rem;outline:none;background:var(--white);color:var(--dark);transition:var(--t)" onfocus="this.style.borderColor='var(--g)'" onblur="this.style.borderColor='var(--border)'"/>
        </div>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:14px">
        <div>
          <label style="font-size:.72rem;font-weight:700;color:var(--mid);display:block;margin-bottom:6px;text-transform:uppercase;letter-spacing:.6px">Nombre de personnes *</label>
          <select id="sr-nbr" style="width:100%;border:2px solid var(--border);border-radius:10px;padding:11px 13px;font-family:'DM Sans',sans-serif;font-size:.88rem;outline:none;background:var(--white);color:var(--dark);transition:var(--t);cursor:pointer" onfocus="this.style.borderColor='var(--g)'" onblur="this.style.borderColor='var(--border)'">
            <option value="">-- Choisir --</option>
            <option>1 – 5 personnes</option>
            <option>6 – 10 personnes</option>
            <option>11 – 20 personnes</option>
            <option>21 – 30 personnes</option>
            <option>30+ personnes</option>
          </select>
        </div>
        <div>
          <label style="font-size:.72rem;font-weight:700;color:var(--mid);display:block;margin-bottom:6px;text-transform:uppercase;letter-spacing:.6px">Occasion</label>
          <select id="sr-occasion" style="width:100%;border:2px solid var(--border);border-radius:10px;padding:11px 13px;font-family:'DM Sans',sans-serif;font-size:.88rem;outline:none;background:var(--white);color:var(--dark);transition:var(--t);cursor:pointer" onfocus="this.style.borderColor='var(--g)'" onblur="this.style.borderColor='var(--border)'">
            <option value="">-- Optionnel --</option>
            <option>Anniversaire 🎂</option>
            <option>Réunion professionnelle 💼</option>
            <option>Repas de famille 👨‍👩‍👧‍👦</option>
            <option>Soirée entre amis 🥂</option>
            <option>Mariage / Fiançailles 💍</option>
            <option>Autre</option>
          </select>
        </div>
      </div>

      <div style="margin-bottom:20px">
        <label style="font-size:.72rem;font-weight:700;color:var(--mid);display:block;margin-bottom:6px;text-transform:uppercase;letter-spacing:.6px">Message / Demandes spéciales</label>
        <textarea id="sr-message" rows="3" placeholder="Ex : décoration souhaitée, régime alimentaire, besoins spécifiques…" style="width:100%;border:2px solid var(--border);border-radius:10px;padding:11px 13px;font-family:'DM Sans',sans-serif;font-size:.88rem;outline:none;background:var(--white);color:var(--dark);resize:none;transition:var(--t)" onfocus="this.style.borderColor='var(--g)'" onblur="this.style.borderColor='var(--border)'"></textarea>
      </div>

      <!-- Boutons -->
      <button onclick="submitSalonReservation()" style="width:100%;background:linear-gradient(135deg,var(--g),var(--g2));color:#fff;border:none;border-radius:12px;padding:14px;font-size:.95rem;font-weight:700;cursor:pointer;font-family:'DM Sans',sans-serif;display:flex;align-items:center;justify-content:center;gap:10px;box-shadow:0 4px 16px rgba(26,107,60,.3);transition:var(--t);margin-bottom:10px" onmouseover="this.style.transform='translateY(-1px)';this.style.boxShadow='0 6px 22px rgba(26,107,60,.42)'" onmouseout="this.style.transform='';this.style.boxShadow='0 4px 16px rgba(26,107,60,.3)'">
        <svg viewBox="0 0 24 24" style="width:18px;height:18px;fill:currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347z"/><path d="M12 0C5.373 0 0 5.373 0 12c0 2.123.554 4.116 1.523 5.845L.057 23.273a.75.75 0 00.92.92l5.428-1.466A11.95 11.95 0 0012 24c6.627 0 12-5.373 12-12S18.627 0 12 0z"/></svg>
        Envoyer via WhatsApp
      </button>
      <button onclick="closeSalonModal()" style="width:100%;background:var(--white);color:var(--mid);border:1.5px solid var(--border);border-radius:12px;padding:11px;font-size:.85rem;font-weight:600;cursor:pointer;font-family:'DM Sans',sans-serif;transition:var(--t)" onmouseover="this.style.borderColor='var(--g)';this.style.color='var(--g)'" onmouseout="this.style.borderColor='var(--border)';this.style.color='var(--mid)'">
        Annuler
      </button>
    </div>
  </div>
</div>

<!-- SEARCH -->
<div class="search-bar">
  <div class="search-wrap">
    <div class="search-icon"><svg viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0016 9.5 6.5 6.5 0 109.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" fill="currentColor"/></svg></div>
    <input class="search-input" id="searchInput" type="text" placeholder="Rechercher un plat ou une boisson…" autocomplete="off"/>
  </div>
</div>

<!-- MENU CONTENT -->
<main id="menuContent"></main>
<div class="no-result" id="noResult">
  <svg viewBox="0 0 24 24"><path d="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3.59-13L12 10.59 8.41 7 7 8.41 10.59 12 7 15.59 8.41 17 12 13.41 15.59 17 17 15.59 13.41 12 17 8.41z" fill="currentColor"/></svg>
  <p>Aucun résultat trouvé</p>
  <small>Essayez un autre mot-clé</small>
</div>

<!-- SCROLL TOP -->
<button id="scrollTop" onclick="window.scrollTo({top:0,behavior:'smooth'})">
  <svg viewBox="0 0 24 24"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"/></svg>
</button>
<div id="toast"></div>

<!-- ══ PANIER DRAWER ════════════════════════════ -->
<div id="cartOverlay" onclick="closeCart()"></div>
<div id="cartDrawer">
  <div class="drawer-head">
    <div class="drawer-head-title">
      <svg viewBox="0 0 24 24"><path d="M17 18c-1.1 0-1.99.9-1.99 2S15.9 22 17 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96C5 16.1 6.1 17 7 17h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63H19c.75 0 1.41-.41 1.75-1.03l3.58-6.49A1 1 0 0023.45 4H5.21l-.94-2H1zm6 14c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2z" fill="currentColor"/></svg>
      <div>
        <h3>Ma Commande</h3>
        <small id="cartTableTag">Restaurant Intégral</small>
      </div>
    </div>
    <button class="btn-close" onclick="closeCart()">✕</button>
  </div>
  <div id="cartItems">
    <div class="cart-empty">
      <svg viewBox="0 0 24 24"><path d="M11 9h2V6h3V4h-3V1h-2v3H8v2h3v3zm-4 9c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zm10 0c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2zm-8.9-5h7.45c.75 0 1.41-.41 1.75-1.03L19 8H7l.4 1.9 3.7 7.8 4.7-5.7" fill="currentColor"/></svg>
      <p>Votre panier est vide</p>
      <small>Ajoutez des plats depuis le menu</small>
    </div>
  </div>
  <div class="drawer-footer" id="cartFooter" style="display:none">
    <div class="cart-total-row">
      <span>Total commande</span>
      <strong id="cartTotal">0 F CFA</strong>
    </div>
    <textarea class="cart-note" id="cartNote" rows="2" placeholder="Note pour la cuisine (sans piment, bien cuit…)"></textarea>
    <button class="btn-wa" onclick="sendWhatsApp()">
      <svg viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347z"/><path d="M12 0C5.373 0 0 5.373 0 12c0 2.126.553 4.122 1.522 5.856L.054 23.5 6.03 22.02A11.935 11.935 0 0012 24c6.627 0 12-5.373 12-12S18.627 0 12 0zm0 21.818a9.818 9.818 0 01-5.006-1.372l-.36-.213-3.72.976.994-3.621-.234-.374A9.818 9.818 0 0112 2.182c5.422 0 9.818 4.396 9.818 9.818 0 5.423-4.396 9.818-9.818 9.818z" fill="currentColor"/></svg>
      Commander via WhatsApp
    </button>
    <div class="cart-secondary-btns">
      <button class="btn-secondary" onclick="genPDF()">
        <svg viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm-1 9h-2v2h2v1h-2v2H9v-6h4v1zm2 4h-1v-5h1v5zm2-3h-1v-2h1v2zM13 9V3.5L18.5 9H13z" fill="currentColor"/></svg>
        Facture PDF
      </button>
      <button class="btn-secondary" onclick="printThermal()">
        <svg viewBox="0 0 24 24"><path d="M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zm-3 11H8v-5h8v5zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-1-9H6v4h12V3z" fill="currentColor"/></svg>
        Impression
      </button>
    </div>
  </div>
</div>

<!-- ══ ADMIN MODAL ══════════════════════════════ -->
<div id="adminModal">
  <div class="modal-box">
    <div class="modal-head">
      <h3>Administration — Intégral Pro</h3>
      <div class="modal-head-btns">
        <button class="btn-expand" id="btnExpand" onclick="toggleFullscreen()" title="Plein écran (F)">⛶</button>
        <button class="btn-close" onclick="closeAdmin()">✕</button>
      </div>
    </div>
    <div class="modal-body">
      <!-- LOGIN -->
      <div id="loginBox">
        <h4>Espace Admin</h4>
        <p>Connectez-vous pour gérer votre restaurant</p>
        <div class="fg"><label>Identifiant</label><input type="text" id="loginUser" placeholder="admin" autocomplete="username"/></div>
        <div class="fg"><label>Mot de passe</label><input type="password" id="loginPass" placeholder="••••••••" autocomplete="current-password" onkeydown="if(event.key==='Enter')doLogin()"/></div>
        <button class="btn-primary" onclick="doLogin()">Se connecter</button>
        <p class="login-err" id="loginErr">Identifiants incorrects.</p>
        <p style="font-size:.7rem;color:var(--muted);margin-top:12px">Démo : admin / INTEGRAL@2030#</p>
      </div>

      <!-- DASHBOARD -->
      <div id="adminDash" style="display:none">
        <div class="admin-tabs">
          <div class="atab active" onclick="switchTab('stats',this)">
            <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z" fill="currentColor"/></svg>
            Statistiques
          </div>
          <div class="atab" onclick="switchTab('orders',this)">
            <svg viewBox="0 0 24 24"><path d="M9 5H7c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2h-2V3H9v2zM7 7h10v12H7V7zm5 3l-3 3h2v4h2v-4h2l-3-3z" fill="currentColor"/></svg>
            Commandes
          </div>
          <div class="atab" onclick="switchTab('menu',this)">
            <svg viewBox="0 0 24 24"><path d="M11 9H9V2H7v7H5V2H3v7c0 2.12 1.66 3.84 3.75 3.97V22h2.5v-9.03C11.34 12.84 13 11.12 13 9V2h-2v7zm5-3v8h2.5v8H21V2c-2.76 0-5 2.24-5 4z" fill="currentColor"/></svg>
            Menu
          </div>
          <div class="atab" onclick="switchTab('config',this)">
            <svg viewBox="0 0 24 24"><path d="M12 15.5A3.5 3.5 0 018.5 12 3.5 3.5 0 0112 8.5a3.5 3.5 0 013.5 3.5 3.5 3.5 0 01-3.5 3.5m7.43-2.92c.04-.34.07-.69.07-1.08s-.03-.73-.07-1.08l2.31-1.81c.21-.16.27-.44.14-.67l-2.19-3.79c-.14-.23-.41-.3-.64-.21l-2.72 1.09c-.57-.43-1.17-.79-1.83-1.07L14.02 3.1A.517.517 0 0013.5 2.7h-3c-.25 0-.46.18-.5.42L9.66 5.44c-.66.28-1.26.64-1.83 1.07L5.11 5.42c-.24-.09-.5-.01-.64.21L2.28 9.42c-.13.23-.07.51.14.67l2.31 1.81c-.04.35-.07.7-.07 1.08s.03.73.07 1.08L2.42 15.87c-.21.16-.27.44-.14.67l2.19 3.79c.14.23.41.3.64.21l2.72-1.09c.57.43 1.17.79 1.83 1.07l.34 2.33c.04.25.25.43.5.43h3c.25 0 .46-.18.5-.42l.34-2.34c.66-.28 1.26-.64 1.83-1.07l2.72 1.09c.24.09.5.01.64-.21l2.19-3.79c.14-.23.07-.51-.14-.67l-2.31-1.8z" fill="currentColor"/></svg>
            Config
          </div>
        </div>

        <!-- STATS -->
        <div id="tab-stats">
          <div class="stats-grid">
            <div class="stat-card"><div class="stat-val" id="st-orders">—</div><div class="stat-label">Commandes</div></div>
            <div class="stat-card gold"><div class="stat-val" id="st-ca">—</div><div class="stat-label">Chiffre F CFA</div></div>
            <div class="stat-card blue"><div class="stat-val" id="st-avg">—</div><div class="stat-label">Ticket moyen</div></div>
            <div class="stat-card"><div class="stat-val" id="st-items">—</div><div class="stat-label">Plats au menu</div></div>
          </div>
          <div class="chart-wrap">
            <div class="chart-title">Top plats commandés</div>
            <div id="topChart"><p style="color:var(--muted);font-size:.85rem;text-align:center;padding:20px">Chargement des données…</p></div>
          </div>
        </div>

        <!-- COMMANDES -->
        <div id="tab-orders" style="display:none">
          <div style="overflow-x:auto">
            <table class="orders-table">
              <thead><tr><th>#</th><th>Table</th><th>Heure</th><th>Plats</th><th>Total</th><th>Note</th></tr></thead>
              <tbody id="ordersBody"><tr><td colspan="6" style="text-align:center;padding:24px;color:var(--muted)">Chargement…</td></tr></tbody>
            </table>
          </div>
        </div>

        <!-- MENU EDITOR -->
        <div id="tab-menu" style="display:none">
          <button class="btn-add-item" onclick="showEditForm()">
            <svg viewBox="0 0 24 24" style="width:16px;height:16px;fill:currentColor"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
            Ajouter un plat
          </button>

          <div class="edit-form" id="editForm">
            <input type="hidden" id="ef-idx"/>
            <div class="form-row-3">
              <div class="fg"><label>Nom du plat *</label><input class="fg input" style="width:100%;border:2px solid var(--border);border-radius:10px;padding:10px 13px;font-family:'DM Sans',sans-serif;font-size:.88rem;outline:none;transition:var(--t);background:var(--white);color:var(--dark)" type="text" id="ef-name" placeholder="Ex: Pizza Florentine"/></div>
              <div class="fg"><label>Prix (F CFA)</label><input style="width:100%;border:2px solid var(--border);border-radius:10px;padding:10px 13px;font-family:'DM Sans',sans-serif;font-size:.88rem;outline:none;background:var(--white);color:var(--dark)" type="number" id="ef-price" placeholder="6000"/></div>
              <div class="fg">
                <label>Catégorie *</label>
                <select style="width:100%;border:2px solid var(--border);border-radius:10px;padding:10px 13px;font-family:'DM Sans',sans-serif;font-size:.88rem;outline:none;background:var(--white);color:var(--dark)" id="ef-cat">
                  <option>Petit-Déjeuner</option><option>Entrées froides</option><option>Entrées chaudes</option>
                  <option>Plats chauds</option><option>Fast food</option><option>Grillades</option>
                  <option>Nos Pizzas</option><option>Accompagnements</option><option>Nos Desserts</option>
                  <option>Jus</option><option>Boissons chaudes</option><option>Sucreries</option>
                  <option>Bières</option><option>Cocktails Sans Alcool</option><option>Cocktails Alcoolisés</option>
                  <option>Nos Vins</option><option>Champagnes</option><option>Liqueurs</option>
                  <option>Whiskys</option><option>Rhums</option><option>Cognacs</option>
                </select>
              </div>
            </div>
            <div class="fg">
              <label>URL de l'image (optionnel)</label>
              <input style="width:100%;border:2px solid var(--border);border-radius:10px;padding:10px 13px;font-family:'DM Sans',sans-serif;font-size:.88rem;outline:none;background:var(--white);color:var(--dark)" type="url" id="ef-img" placeholder="https://exemple.com/photo.jpg" oninput="previewImg(this.value)"/>
              <img class="img-preview" id="ef-preview" alt="Aperçu"/>
            </div>
            <div class="toggle-dispo" onclick="toggleDispoForm()">
              <div class="toggle-switch active" id="ef-dispo-toggle"></div>
              <span id="ef-dispo-label">Disponible</span>
            </div>
            <div style="display:flex;gap:10px;margin-top:14px">
              <button class="btn-primary" onclick="saveItem()" style="flex:1;padding:11px">Enregistrer</button>
              <button onclick="cancelEdit()" style="flex:1;padding:11px;border:2px solid var(--border);border-radius:10px;cursor:pointer;background:var(--white);color:var(--dark);font-family:'DM Sans',sans-serif;font-weight:600;transition:var(--t)">Annuler</button>
            </div>
          </div>

          <div class="me-grid" id="menuEditorList"></div>
        </div>

        <!-- CONFIG -->
        <div id="tab-config" style="display:none">
          <div style="max-width:520px">
            <div class="config-section">
              <h5>
                <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 14H9V8h2v8zm4 0h-2V8h2v8z" fill="currentColor"/></svg>
                Restaurant
              </h5>
              <div class="fg"><label>Nom</label><input style="width:100%;border:2px solid var(--border);border-radius:10px;padding:10px 13px;font-family:'DM Sans',sans-serif;font-size:.88rem;outline:none;background:var(--white);color:var(--dark)" type="text" id="cfg-name" value="Intégral"/></div>
              <div class="fg"><label>Adresse</label><input style="width:100%;border:2px solid var(--border);border-radius:10px;padding:10px 13px;font-family:'DM Sans',sans-serif;font-size:.88rem;outline:none;background:var(--white);color:var(--dark)" type="text" id="cfg-addr" value="Ouagadougou, Burkina Faso"/></div>
              <div class="fg"><label>Slogan</label><input style="width:100%;border:2px solid var(--border);border-radius:10px;padding:10px 13px;font-family:'DM Sans',sans-serif;font-size:.88rem;outline:none;background:var(--white);color:var(--dark)" type="text" id="cfg-hero" value="Découvrez nos délices culinaires"/></div>
            </div>
            <div class="config-section">
              <h5>
                <svg viewBox="0 0 24 24"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02L6.62 10.79z" fill="currentColor"/></svg>
                WhatsApp
              </h5>
              <div class="fg"><label>Numéro WhatsApp (avec indicatif)</label><input style="width:100%;border:2px solid var(--border);border-radius:10px;padding:10px 13px;font-family:'DM Sans',sans-serif;font-size:.88rem;outline:none;background:var(--white);color:var(--dark)" type="text" id="cfg-wa" value="22654470091"/></div>
            </div>
            <div class="config-section">
              <h5>
                <svg viewBox="0 0 24 24"><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z" fill="currentColor"/></svg>
                Sécurité
              </h5>
              <div class="form-row">
                <div class="fg"><label>Nouveau mot de passe</label><input style="width:100%;border:2px solid var(--border);border-radius:10px;padding:10px 13px;font-family:'DM Sans',sans-serif;font-size:.88rem;outline:none;background:var(--white);color:var(--dark)" type="password" id="cfg-pass" placeholder="Laisser vide = inchangé"/></div>
                <div class="fg"><label>Confirmer</label><input style="width:100%;border:2px solid var(--border);border-radius:10px;padding:10px 13px;font-family:'DM Sans',sans-serif;font-size:.88rem;outline:none;background:var(--white);color:var(--dark)" type="password" id="cfg-pass2" placeholder="Confirmer"/></div>
              </div>
            </div>
            <div style="display:flex;gap:10px">
              <button class="btn-primary" style="flex:1" onclick="saveConfig()">Sauvegarder</button>
              <button onclick="doLogout()" style="padding:11px 18px;border:2px solid var(--red);border-radius:10px;color:var(--red);background:transparent;cursor:pointer;font-family:'DM Sans',sans-serif;font-weight:700;transition:var(--t)">Déconnexion</button>
            </div>
          </div>
        </div>
      </div><!-- /adminDash -->
    </div>
  </div>
</div>

<!-- QR CODE MODAL -->
<div id="qrModal">
  <div class="qr-box">
    <h3>QR Code Menu</h3>
    <p>Scannez pour accéder au menu digital</p>
    <div id="qrCanvas"></div>
    <div class="qr-url" id="qrUrl"></div>
    <button class="qr-close" onclick="document.getElementById('qrModal').classList.remove('open')">Fermer</button>
  </div>
</div>

<!-- ══════════════════════════════════════════════════════
     JAVASCRIPT PRINCIPAL
══════════════════════════════════════════════════════ -->
<script>
// ══ CONFIG ═══════════════════════════════════════
const CONFIG = {
  waNumber: '22654470091',
  adminUser: 'admin',
  adminPass: 'INTEGRAL@2030#',
  restaurantName: 'Intégral',
  restaurantAddr: 'Ouagadougou, Burkina Faso',
};

// ══ URL PARAMS (QR table/salon) ══════════════════
const urlParams  = new URLSearchParams(window.location.search);
const tableNum   = urlParams.get('table');
const salonName  = urlParams.get('salon');
let   tableLabel = null;
if(tableNum)  tableLabel = 'Table ' + tableNum;
if(salonName) tableLabel = 'Salon ' + salonName;

if(tableLabel){
  const banner = document.getElementById('tableBanner');
  banner.textContent = 'Vous êtes au : ' + tableLabel + ' — Bienvenue !';
  banner.classList.add('show');
  document.getElementById('cartTableTag').textContent = tableLabel;
  requestAnimationFrame(() => {
    const bH = banner.offsetHeight;
    document.getElementById('navWrapper').style.top = (56 + bH) + 'px';
  });
}

// ══ IMAGE MAPPING ════════════════════════════════
// Unsplash IDs pour chaque catégorie/item — remplace les emojis
const IMG = {
  // Photos fiables Unsplash
  omelette:   'photo-1525351484163-7529414344d8',
  croissant:  'photo-1555507036-ab1f4038808a',
  painChoc:   'photo-1509365465985-25d11c17e812',
  sandwich:   'photo-1528735602780-2552fd46c7af',
  rognon:     'photo-1544025162-d76538b2a681',
  gesier:     'photo-1544025162-d76538b2a681',
  saladeVerte:'photo-1512621776951-a57141f2eefd',
  saladeComp: 'photo-1540189549336-e6e99c3679fe',
  saladeMixte:'photo-1512621776951-a57141f2eefd',
  saladeNicoi:'photo-1547592180-85f173990554',
  avocat:     'photo-1512787397060-f519f2f35c07',
  nem:        'photo-1569050467447-ce54b3bbc37d',
  brique:     'photo-1563245372-f21724e3856d',
  roti:       'photo-1501200291289-c5a76c232e5f',
  steack:     'photo-1546833999-b9f581a1996d',
  cotePorcMiel:'photo-1529193591184-b1d58069ecdd',
  pouletSaute:'photo-1587593810167-a84920ea0781',
  pilon:      'photo-1527477396000-e27163b481c2',
  aileron:    'photo-1527477396000-e27163b481c2',
  pizza:      'photo-1565299624946-b28f40a0ae38',
  burger:     'photo-1568901346375-23c9450c58cd',
  cheeseBurger:'photo-1553979459-d2229ba7433b',
  phillyPoulet:'photo-1561651188-d207bbec4ec3',
  phillyBoeuf:'photo-1561651188-d207bbec4ec3',
  chawarma:   'photo-1561651188-d207bbec4ec3',
  clubSandwich:'photo-1528735602780-2552fd46c7af',
  capitaine:  'photo-1519708227418-c8fd9a32b7a2',
  carpe:      'photo-1519708227418-c8fd9a32b7a2',
  brochette:  'photo-1529543544282-ea669407fca3',
  merguez:    'photo-1529543544282-ea669407fca3',
  saucisse:   'photo-1473093295043-cdd812d0e601',
  gratin:     'photo-1548869190-0e40f9537e96',
  pomme:      'photo-1568702846914-96b305d2aaeb',
  aloco:      'photo-1590694451659-c65e9f0c1bf0',
  frite:      'photo-1573080496219-bb964701c433',
  riz:        'photo-1516684732162-798a0062be99',
  crepe:      'photo-1519676867240-f03562e64548',
  saladeFruit:'photo-1490474418585-ba9bad8fd0ea',
  cremeCaramel:'photo-1488477181946-6428a0291777',
  fruit:      'photo-1490474418585-ba9bad8fd0ea',
  jus:        'photo-1600271886742-f049cd451bba',
  jusCitron:  'photo-1602584386319-fa8eb4361c2a',
  ananas:     'photo-1589820296156-2454bb8a6ad1',
  orange:     'photo-1552070078-4545f8a784b5',
  gingembre:  'photo-1615485290382-441e4d049cb5',
  the:        'photo-1556679343-c7306c1976bc',
  cafe:       'photo-1509042239860-f550ce710b93',
  cappuccino: 'photo-1534778101976-62847782c213',
  chocolat:   'photo-1578916171728-46686eac8d58',
  cocktailSA: 'photo-1541167760496-1628856ab772',
  cocktailAl: 'photo-1551024709-8f23befc6f87',
  biere:      'photo-1535958636474-b021ee887b13',
  coca:       'photo-1555001426-788f73e5b10a',
  fanta:      'photo-1554160090-74484d165d57',
  vin:        'photo-1510812431401-41d2bd2722f3',
  champagne:  'photo-1543353071-087092ec393a',
  whisky:     'photo-1569529465841-dfecdab7503b',
  cognac:     'photo-1569529465841-dfecdab7503b',
  rhum:       'photo-1569529465841-dfecdab7503b',
  liqueur:    'photo-1569529465841-dfecdab7503b',
  defaultFood:'photo-1546069901-ba9599a7e63c',
};

function getItemImageUrl(item){
  if(item.img && item.img.startsWith('http')) return item.img;
  const n = item.nom.toLowerCase();
  const c = item.cat.toLowerCase();
  let id = null;

  // Specific mappings
  if(n.includes('rognon'))            id = IMG.rognon;
  else if(n.includes('foie'))         id = IMG.gesier;
  else if(n.includes('gesier')||n.includes('gésier')) id = IMG.gesier;
  else if(n.includes('croissant'))    id = IMG.croissant;
  else if(n.includes('pain au chocolat')) id = IMG.painChoc;
  else if(n.includes('omelette'))     id = IMG.omelette;
  else if(n.includes('oeuf')||n.includes('œuf')) id = IMG.omelette;
  else if(n.includes('sandwich')||n.includes('club')) id = IMG.sandwich;
  else if(n.includes('niçoise'))      id = IMG.saladeNicoi;
  else if(n.includes('avocat'))       id = IMG.avocat;
  else if(n.includes('nem'))          id = IMG.nem;
  else if(n.includes('brique'))       id = IMG.brique;
  else if(n.includes('caille'))       id = IMG.roti;
  else if(n.includes('steack')||n.includes('steak')) id = IMG.steack;
  else if(n.includes('côte de porc')&&n.includes('miel')) id = IMG.cotePorcMiel;
  else if(n.includes('côte de porc')) id = IMG.cotePorcMiel;
  else if(n.includes('poulet sauté')) id = IMG.pouletSaute;
  else if(n.includes('pilon'))        id = IMG.pilon;
  else if(n.includes('aileron'))      id = IMG.aileron;
  else if(n.includes('pizza'))        id = IMG.pizza;
  else if(n.includes('cheese burger')) id = IMG.cheeseBurger;
  else if(n.includes('hamburger')||n.includes('burger')) id = IMG.burger;
  else if(n.includes('philly'))       id = IMG.phillyPoulet;
  else if(n.includes('chawarma'))     id = IMG.chawarma;
  else if(n.includes('capitaine'))    id = IMG.capitaine;
  else if(n.includes('carpe'))        id = IMG.carpe;
  else if(n.includes('brochette'))    id = IMG.brochette;
  else if(n.includes('merguez'))      id = IMG.merguez;
  else if(n.includes('saucisse'))     id = IMG.saucisse;
  else if(n.includes('gratin'))       id = IMG.gratin;
  else if(n.includes('aloco'))        id = IMG.aloco;
  else if(n.includes('frite'))        id = IMG.frite;
  else if(n.includes('riz'))          id = IMG.riz;
  else if(n.includes('crêpe')||n.includes('crepe')) id = IMG.crepe;
  else if(n.includes('salade de fruit')) id = IMG.saladeFruit;
  else if(n.includes('crème caramel')) id = IMG.cremeCaramel;
  else if(n.includes('fruit'))        id = IMG.fruit;
  else if(n.includes('gingembre')&&c.includes('jus')) id = IMG.gingembre;
  else if(n.includes('ananas'))       id = IMG.ananas;
  else if(n.includes('orange'))       id = IMG.orange;
  else if(n.includes('cappuccino'))   id = IMG.cappuccino;
  else if(n.includes('café')||n.includes('cafe')||n.includes('nespresso')) id = IMG.cafe;
  else if(n.includes('chocolat chaud')) id = IMG.chocolat;
  else if(n.includes('thé')||n.includes('the')) id = IMG.the;
  else if(n.includes('coca'))         id = IMG.coca;
  else if(n.includes('fanta'))        id = IMG.fanta;
  else if(n.includes('sprite'))       id = IMG.coca;
  else if(n.includes('heineken')||n.includes('guiness')||n.includes('bière')||n.includes('biere')) id = IMG.biere;
  else if(n.includes('champagne')||n.includes('nicolas')||n.includes('laurent')||n.includes('moet')) id = IMG.champagne;
  else if(n.includes('whisky')||n.includes('jack daniel')||n.includes('chivas')||n.includes('glenfiddich')) id = IMG.whisky;
  else if(n.includes('cognac')||n.includes('hennessy')||n.includes('saint remy')) id = IMG.cognac;
  else if(n.includes('rhum')||n.includes('diplomatico')) id = IMG.rhum;
  else if(n.includes('ricard')||n.includes('baillay')||n.includes('jager')) id = IMG.liqueur;
  else if(n.includes('vin')||n.includes('rosé')) id = IMG.vin;
  else if(c.includes('cocktail sans')) id = IMG.cocktailSA;
  else if(c.includes('cocktail alc')) id = IMG.cocktailAl;
  else if(c.includes('jus'))          id = IMG.jus;
  else if(c.includes('salade'))       id = IMG.saladeVerte;
  else if(c.includes('plats chauds')) id = IMG.pouletSaute;
  else if(c.includes('fast food'))    id = IMG.burger;
  else if(c.includes('grillades'))    id = IMG.brochette;
  else if(c.includes('pizza'))        id = IMG.pizza;
  else if(c.includes('dessert'))      id = IMG.crepe;
  else if(c.includes('petit'))        id = IMG.omelette;
  else                                id = IMG.defaultFood;

  return `https://images.unsplash.com/${id}?w=400&h=300&fit=crop&auto=format`;
}

// ══ MENU DATA ════════════════════════════════════
window.MENU = [
  // ── Petit-Déjeuner
  {cat:"Petit-Déjeuner",nom:"Rognon sauté",prix:2000,img: "https://image2url.com/r2/default/images/1771593477187-4416a69f-381f-408c-a810-695718b0d675.jpeg"},
  {cat:"Petit-Déjeuner",nom:"Foie sauté",prix:2000,img: "https://image2url.com/r2/default/images/1771594087285-1f3e6f8d-225d-406b-98bd-dff428767301.jpg"},
  {cat:"Petit-Déjeuner",nom:"Croissant",prix:600,img:""},
  {cat:"Petit-Déjeuner",nom:"Pain au chocolat",prix:600,img:""},
  {cat:"Petit-Déjeuner",nom:"Omelette Nature",prix:1500,img:""},
  {cat:"Petit-Déjeuner",nom:"Omelette fromage",prix:1500,img:""},
  {cat:"Petit-Déjeuner",nom:"Omelette Jambon Fromage",prix:2500,img:""},
  {cat:"Petit-Déjeuner",nom:"Omelette au jambon",prix:2000,img:""},
  {cat:"Petit-Déjeuner",nom:"Oeuf au plat",prix:1500,img:""},
  {cat:"Petit-Déjeuner",nom:"Gésier sauté",prix:2000,img:""},
  {cat:"Petit-Déjeuner",nom:"Sandwich viande hachée",prix:1000,img:""},
  {cat:"Petit-Déjeuner",nom:"Sandwich merguez",prix:1500,img:""},
  {cat:"Petit-Déjeuner",nom:"Sandwich omelette",prix:1500,img:""},
  {cat:"Petit-Déjeuner",nom:"Sandwich au jambon",prix:1500,img:""},
  {cat:"Petit-Déjeuner",nom:"Sandwich au jambon fromage",prix:2000,img:""},
  // ── Entrées froides
  {cat:"Entrées froides",nom:"Salade verte",prix:1000,img:""},
  {cat:"Entrées froides",nom:"Salade d'avocat au basilique",prix:2000,img:""},
  {cat:"Entrées froides",nom:"Salade composée",prix:2000,img:""},
  {cat:"Entrées froides",nom:"Salade intégral",prix:3000,img:""},
  {cat:"Entrées froides",nom:"Salade mixte",prix:1500,img:""},
  {cat:"Entrées froides",nom:"Salade Niçoise",prix:3000,img:""},
  // ── Entrées chaudes
  {cat:"Entrées chaudes",nom:"Salade de gesier ou foie de volaille",prix:2000,img:""},
  {cat:"Entrées chaudes",nom:"Nem Chinoise",prix:2000,img:""},
  {cat:"Entrées chaudes",nom:"Briques",prix:2000,img:""},
  // ── Plats chauds
  {cat:"Plats chauds",nom:"Rôti de caille",prix:7500,img:""},
  {cat:"Plats chauds",nom:"Côte de porc au miel",prix:5000,img:""},
  {cat:"Plats chauds",nom:"Steack sauce au poivre vert",prix:5500,img:""},
  {cat:"Plats chauds",nom:"Steack à la crème aux champignons",prix:5500,img:""},
  {cat:"Plats chauds",nom:"Steack à point",prix:5500,img:""},
  {cat:"Plats chauds",nom:"Poulet sauté",prix:6000,img:""},
  {cat:"Plats chauds",nom:"Pilon de poulet pané",prix:5000,img:""},
  {cat:"Plats chauds",nom:"Aileron de Poulet",prix:4000,img:""},
  // ── Fast food
  {cat:"Fast food",nom:"Hamburger Classique",prix:2000,img:""},
  {cat:"Fast food",nom:"Cheese Burger",prix:2500,img:""},
  {cat:"Fast food",nom:"Philly cheese poulet",prix:7000,img:""},
  {cat:"Fast food",nom:"Philly cheese boeuf",prix:7000,img:""},
  {cat:"Fast food",nom:"Chawarma poulet",prix:2500,img:""},
  {cat:"Fast food",nom:"Chawarma Boeuf",prix:2000,img:""},
  {cat:"Fast food",nom:"Club sandwich",prix:2500,img:""},
  // ── Grillades
  {cat:"Grillades",nom:"Pavé de capitaine à l'aile",prix:7000,img:""},
  {cat:"Grillades",nom:"Côte de porc grillé aux herbes",prix:4500,img:""},
  {cat:"Grillades",nom:"Poulet grillé à l'aile",prix:5000,img:""},
  {cat:"Grillades",nom:"Merguez grillée",prix:2000,img:""},
  {cat:"Grillades",nom:"Carpe d'eau douce braisé",prix:5000,img:""},
  {cat:"Grillades",nom:"Brochette de filet de capitaine",prix:7000,img:""},
  {cat:"Grillades",nom:"Brochette de poulet",prix:5000,img:""},
  {cat:"Grillades",nom:"Brochette de filet de boeuf",prix:2000,img:""},
  {cat:"Grillades",nom:"Saucisse grillée",prix:3000,img:""},
  // ── Pizzas
  {cat:"Nos Pizzas",nom:"Pizza Sicilienne",prix:6000,img:""},
  {cat:"Nos Pizzas",nom:"Pizza Integral",prix:7000,img:""},
  {cat:"Nos Pizzas",nom:"Pizza Quatre saisons",prix:6000,img:""},
  {cat:"Nos Pizzas",nom:"Pizza poulet",prix:6000,img:""},
  {cat:"Nos Pizzas",nom:"Pizza Margherita",prix:5000,img:""},
  {cat:"Nos Pizzas",nom:"Pizza Reine",prix:6000,img:""},
  {cat:"Nos Pizzas",nom:"Pizza thon",prix:6000,img:""},
  // ── Accompagnements
  {cat:"Accompagnements",nom:"Gratin dauphinois",prix:2000,img:""},
  {cat:"Accompagnements",nom:"Pomme sautée",prix:1000,img:""},
  {cat:"Accompagnements",nom:"Aloco",prix:1000,img:""},
  {cat:"Accompagnements",nom:"Frite de pomme de terre",prix:1000,img:""},
  {cat:"Accompagnements",nom:"Riz blanc",prix:1000,img:""},
  // ── Desserts
  {cat:"Nos Desserts",nom:"Crêpes (confiture, miel ou chocolat)",prix:1500,img:""},
  {cat:"Nos Desserts",nom:"Crêpes natures",prix:1000,img:""},
  {cat:"Nos Desserts",nom:"Salade de fruit",prix:1500,img:""},
  {cat:"Nos Desserts",nom:"Crème caramel",prix:1500,img:""},
  {cat:"Nos Desserts",nom:"Fruit saison",prix:1000,img:""},
  // ── Jus
  {cat:"Jus",nom:"Jus de gingembre",prix:1000,img:""},
  {cat:"Jus",nom:"Jus d'ananas",prix:1500,img:""},
  {cat:"Jus",nom:"Jus de bissap",prix:1000,img:""},
  {cat:"Jus",nom:"Jus d'orange frais",prix:1500,img:""},
  {cat:"Jus",nom:"Jus de pain de singe",prix:1000,img:""},
  // ── Boissons chaudes
  {cat:"Boissons chaudes",nom:"Thé vert de Chine",prix:1000,img:""},
  {cat:"Boissons chaudes",nom:"Chocolat chaud",prix:1000,img:""},
  {cat:"Boissons chaudes",nom:"Café Nespresso vanille",prix:1000,img:""},
  {cat:"Boissons chaudes",nom:"Cappuccino",prix:1000,img:""},
  {cat:"Boissons chaudes",nom:"Thé au Curcuma",prix:600,img:""},
  {cat:"Boissons chaudes",nom:"Thé au Gingembre",prix:600,img:""},
  {cat:"Boissons chaudes",nom:"Thé Indien",prix:1000,img:""},
  // ── Sucreries
  {cat:"Sucreries",nom:"Fanta orange 33 cl",prix:1000,img:""},
  {cat:"Sucreries",nom:"Sprite 33 cl",prix:1000,img:""},
  {cat:"Sucreries",nom:"Coca cola 33 cl",prix:1000,img:""},
  // ── Bières
  {cat:"Bières",nom:"Heineken 33 cl",prix:1500,img:""},
  {cat:"Bières",nom:"Guiness 33 cl",prix:1500,img:""},
  {cat:"Bières",nom:"Bière à pression 50 cl",prix:1500,img:""},
  // ── Cocktails Sans Alcool
  {cat:"Cocktails Sans Alcool",nom:"Love Ouaga",prix:2000,img:""},
  {cat:"Cocktails Sans Alcool",nom:"Rose bonbon",prix:2000,img:""},
  {cat:"Cocktails Sans Alcool",nom:"Virgine mogito",prix:2000,img:""},
  {cat:"Cocktails Sans Alcool",nom:"Bora-Bora",prix:2000,img:""},
  {cat:"Cocktails Sans Alcool",nom:"Sunrise",prix:2000,img:""},
  {cat:"Cocktails Sans Alcool",nom:"Tutti fruiti",prix:2000,img:""},
  {cat:"Cocktails Sans Alcool",nom:"J'adore",prix:2000,img:""},
  {cat:"Cocktails Sans Alcool",nom:"Red diamond",prix:2000,img:""},
  // ── Cocktails Alcoolisés
  {cat:"Cocktails Alcoolisés",nom:"C'est qui le boss",prix:4000,img:""},
  {cat:"Cocktails Alcoolisés",nom:"Passion royale",prix:4000,img:""},
  {cat:"Cocktails Alcoolisés",nom:"Mogito",prix:4000,img:""},
  {cat:"Cocktails Alcoolisés",nom:"Queens",prix:4000,img:""},
  {cat:"Cocktails Alcoolisés",nom:"Integral express",prix:4000,img:""},
  {cat:"Cocktails Alcoolisés",nom:"Bailleys colada",prix:4000,img:""},
  {cat:"Cocktails Alcoolisés",nom:"La toride",prix:4000,img:""},
  {cat:"Cocktails Alcoolisés",nom:"Margueritha",prix:4000,img:""},
  {cat:"Cocktails Alcoolisés",nom:"Sexe on the beach",prix:4000,img:""},
  {cat:"Cocktails Alcoolisés",nom:"Téquila sunrise",prix:4000,img:""},
  {cat:"Cocktails Alcoolisés",nom:"Mogito passion",prix:4000,img:""},
  {cat:"Cocktails Alcoolisés",nom:"Folie de minuit",prix:4000,img:""},
  // ── Vins
  {cat:"Nos Vins",nom:"Vin blanc moelleux",prix:0,img:"",prixLabel:"Prix variable"},
  {cat:"Nos Vins",nom:"Vin Rouge",prix:0,img:"",prixLabel:"Prix variable"},
  {cat:"Nos Vins",nom:"Vin rosé",prix:0,img:"",prixLabel:"Prix variable"},
  // ── Champagnes
  {cat:"Champagnes",nom:"Nicolas feuillate",prix:28000,img:""},
  {cat:"Champagnes",nom:"Laurent Perrier",prix:33000,img:""},
  {cat:"Champagnes",nom:"Luc Belair Gold",prix:18000,img:""},
  {cat:"Champagnes",nom:"Moet & Chamdor",prix:33000,img: "https://image2url.com/r2/default/images/1771591601286-e276573f-f686-4d71-acb2-31040de34b94.jpeg"},
  {cat:"Champagnes",nom:"Cooks brut",prix:19000,img:""},
  // ── Liqueurs
  {cat:"Liqueurs",nom:"Ricard / Pastis 51 (Bouteille)",prix:11000,img:""},
  {cat:"Liqueurs",nom:"Ricard / Pastis 51 (Verre)",prix:1000,img:""},
  {cat:"Liqueurs",nom:"Jagermeister Mast 1L (Bouteille)",prix:11000,img:""},
  {cat:"Liqueurs",nom:"Baillay's 70 cl",prix:11000,img:""},
  // ── Whiskys
  {cat:"Whiskys",nom:"Red label 1L (Bouteille)",prix:11000,img:""},
  {cat:"Whiskys",nom:"Red label 1L (Verre)",prix:1000,img:""},
  {cat:"Whiskys",nom:"Black label 1L (Verre)",prix:2000,img:""},
  {cat:"Whiskys",nom:"Gold label 1L",prix:45000,img:""},
  {cat:"Whiskys",nom:"Chivas 12 ans 1L",prix:23000,img:""},
  {cat:"Whiskys",nom:"Jack Daniel's 1L (Bouteille)",prix:18000,img:""},
  {cat:"Whiskys",nom:"Jack Daniel's 1L (Verre)",prix:1500,img:""},
  {cat:"Whiskys",nom:"Jack Daniel's Honey 1L",prix:19000,img:""},
  {cat:"Whiskys",nom:"Glenfiddich 12 ans",prix:29000,img:""},
  // ── Rhums
  {cat:"Rhums",nom:"Diplomatico",prix:33000,img:""},
  // ── Cognacs
  {cat:"Cognacs",nom:"Hennessy VS 1L",prix:42000,img:""},
  {cat:"Cognacs",nom:"Hennessy VSOP 1L",prix:50000,img:""},
  {cat:"Cognacs",nom:"Saint Remy VSOP 1L",prix:17000,img:""},
];

// ══ PANIER ═══════════════════════════════════════
let cart = [];

function fmt(n){
  if(n === 0) return '—';
  return n.toLocaleString('fr-FR') + ' F CFA';
}

function addToCart(nom, prix){
  if(prix === 0){ showToast('Prix sur demande — appelez le serveur'); return; }
  const existing = cart.find(i => i.nom === nom);
  if(existing){ existing.qty++; }
  else {
    const item = window.MENU.find(i => i.nom === nom);
    cart.push({nom, prix, qty:1, img: getItemImageUrl(item||{nom,img:''})});
  }
  updateCartUI();
  showToast(nom.slice(0,26) + ' ajouté au panier', 'green');
  // Micro-animation bouton
  const btn = document.querySelector(`.btn-add[data-nom="${CSS.escape(nom)}"]`);
  if(btn){ btn.style.transform='scale(.85)'; setTimeout(()=>btn.style.transform='',200); }
  updateCardQtyDisplay(nom);
}

function changeQty(i, d){
  cart[i].qty += d;
  if(cart[i].qty <= 0) cart.splice(i, 1);
  updateCartUI();
  updateAllCardQtyDisplays();
}

function removeItem(i){
  const nom = cart[i].nom;
  cart.splice(i, 1);
  updateCartUI();
  updateCardQtyDisplay(nom);
}

function updateCardQtyDisplay(nom){
  const qty = (cart.find(i=>i.nom===nom)||{qty:0}).qty;
  const card = document.querySelector(`.card[data-nom="${CSS.escape(nom)}"]`);
  if(!card) return;
  const addBtn = card.querySelector('.btn-add');
  const qtyCtrl = card.querySelector('.card-qty-ctrl');
  if(!addBtn||!qtyCtrl) return;
  if(qty > 0){
    addBtn.style.display = 'none';
    qtyCtrl.style.display = 'flex';
    qtyCtrl.querySelector('.cq-val').textContent = qty;
  } else {
    addBtn.style.display = 'flex';
    qtyCtrl.style.display = 'none';
  }
}

function updateAllCardQtyDisplays(){
  cart.forEach(it => updateCardQtyDisplay(it.nom));
  // Also reset removed items
  document.querySelectorAll('.card').forEach(card => {
    const nom = card.dataset.nom;
    if(!nom) return;
    const inCart = cart.find(i=>i.nom===nom);
    if(!inCart){
      const addBtn = card.querySelector('.btn-add');
      const qtyCtrl = card.querySelector('.card-qty-ctrl');
      if(addBtn) addBtn.style.display = 'flex';
      if(qtyCtrl) qtyCtrl.style.display = 'none';
    }
  });
}

function updateCartUI(){
  const total = cart.reduce((s,i) => s + i.prix*i.qty, 0);
  const count = cart.reduce((s,i) => s + i.qty, 0);
  const badge = document.getElementById('cartBadge');
  badge.textContent = count;
  badge.classList.toggle('show', count > 0);

  const itemsEl = document.getElementById('cartItems');
  const footer  = document.getElementById('cartFooter');

  if(!cart.length){
    itemsEl.innerHTML = `
      <div class="cart-empty">
        <svg viewBox="0 0 24 24"><path d="M11 9h2V6h3V4h-3V1h-2v3H8v2h3v3zm-4 9c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zm10 0c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2zm-8.9-5h7.45c.75 0 1.41-.41 1.75-1.03L19 8H7l.4 1.9 3.7 7.8 4.7-5.7" fill="currentColor"/></svg>
        <p>Votre panier est vide</p>
        <small>Ajoutez des plats depuis le menu</small>
      </div>`;
    footer.style.display = 'none';
    return;
  }

  footer.style.display = 'block';
  document.getElementById('cartTotal').textContent = fmt(total);

  itemsEl.innerHTML = cart.map((it,i) => `
    <div class="cart-item">
      <img class="ci-thumb" src="${it.img}" alt="${it.nom}" loading="lazy" onerror="this.src='https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=80&h=80&fit=crop'"/>
      <div class="ci-info">
        <div class="ci-name">${it.nom}</div>
        <div class="ci-unit-price">${fmt(it.prix)} / unité</div>
        <div class="ci-qty-row">
          <button class="ciq-btn" onclick="changeQty(${i},-1)">−</button>
          <span class="ciq-val">${it.qty}</span>
          <button class="ciq-btn" onclick="changeQty(${i},1)">+</button>
        </div>
      </div>
      <div class="ci-price">${fmt(it.prix*it.qty)}</div>
      <button class="btn-rm" onclick="removeItem(${i})" title="Retirer">
        <svg viewBox="0 0 24 24"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z" fill="currentColor"/></svg>
      </button>
    </div>`).join('');
}

function openCart(){
  document.getElementById('cartDrawer').classList.add('open');
  document.getElementById('cartOverlay').classList.add('open');
}
function closeCart(){
  document.getElementById('cartDrawer').classList.remove('open');
  document.getElementById('cartOverlay').classList.remove('open');
}

function sendWhatsApp(){
  if(!cart.length){ showToast('Panier vide !','red'); return; }
  const note  = document.getElementById('cartNote').value;
  const total = cart.reduce((s,i) => s+i.prix*i.qty, 0);
  let msg = '*Commande — Restaurant Intégral*\n';
  if(tableLabel) msg += 'Lieu : *' + tableLabel + '*\n';
  msg += '─────────────────────\n';
  cart.forEach(it => { msg += `• ${it.nom} x${it.qty} = ${fmt(it.prix*it.qty)}\n`; });
  msg += '─────────────────────\n';
  msg += `*TOTAL : ${fmt(total)}*`;
  if(note) msg += `\nNote : ${note}`;

  window.open('https://wa.me/' + CONFIG.waNumber + '?text=' + encodeURIComponent(msg), '_blank');
  showToast('Commande envoyée sur WhatsApp !', 'green');

  if(window.fbSaveOrder){
    window.fbSaveOrder({
      table: tableLabel || 'Non précisé',
      items: cart.map(i => ({nom:i.nom, qty:i.qty, prix:i.prix})),
      total, note, statut: 'nouveau'
    }).catch(e => console.warn('Firebase order:', e));
  }
}

// ══ PDF ═════════════════════════════════════════
function genPDF(){
  if(!cart.length){ showToast('Panier vide !','red'); return; }
  const {jsPDF} = window.jspdf;
  const doc = new jsPDF();
  const total = cart.reduce((s,i) => s+i.prix*i.qty, 0);
  const now = new Date();
  const dateStr = now.toLocaleDateString('fr-FR') + ' ' + now.toLocaleTimeString('fr-FR',{hour:'2-digit',minute:'2-digit'});
  const num = 'INT-' + Date.now().toString().slice(-6);

  // Header
  doc.setFillColor(26,107,60); doc.rect(0,0,210,42,'F');
  doc.setFillColor(201,168,76); doc.rect(0,40,210,3,'F');
  doc.setTextColor(255,255,255); doc.setFont('helvetica','bold'); doc.setFontSize(22);
  doc.text('INTEGRAL', 20, 20);
  doc.setFontSize(9); doc.setFont('helvetica','normal');
  doc.text('integral.muse.site  |  +' + CONFIG.waNumber + '  |  Ouagadougou, Burkina Faso', 20, 30);
  if(tableLabel){ doc.text('Lieu : ' + tableLabel, 20, 38); }

  // Info
  doc.setTextColor(40,40,40);
  doc.setFontSize(11); doc.setFont('helvetica','bold');
  doc.text('TICKET DE COMMANDE', 20, 58);
  doc.setFont('helvetica','normal'); doc.setFontSize(8.5);
  doc.text('N° : ' + num, 20, 67);
  doc.text('Date : ' + dateStr, 20, 74);

  // Table header
  let y = 90;
  doc.setFillColor(230,245,238); doc.rect(15,y-7,180,12,'F');
  doc.setFont('helvetica','bold'); doc.setFontSize(8.5); doc.setTextColor(26,107,60);
  doc.text('Article', 18, y);
  doc.text('Qté', 118, y);
  doc.text('P.U.', 140, y);
  doc.text('Total', 168, y);
  doc.setDrawColor(201,168,76); doc.line(15,y+3,195,y+3);

  y += 12;
  doc.setFont('helvetica','normal'); doc.setTextColor(40,40,40);
  cart.forEach((it,idx) => {
    if(y > 265){ doc.addPage(); y = 20; }
    if(idx % 2 === 0){ doc.setFillColor(250,253,251); doc.rect(15,y-5,180,9,'F'); }
    doc.text(it.nom.slice(0,42), 18, y);
    doc.text(String(it.qty), 122, y);
    doc.text(it.prix.toLocaleString('fr-FR'), 140, y);
    doc.text((it.prix*it.qty).toLocaleString('fr-FR'), 168, y);
    y += 9;
  });

  y += 6;
  doc.setFillColor(26,107,60); doc.rect(120,y-6,75,14,'F');
  doc.setTextColor(255,255,255); doc.setFont('helvetica','bold'); doc.setFontSize(10);
  doc.text('TOTAL : ' + total.toLocaleString('fr-FR') + ' F CFA', 123, y+3);

  doc.setTextColor(160,160,160); doc.setFont('helvetica','normal'); doc.setFontSize(7.5);
  doc.text('Merci de votre visite — Intégral vous souhaite une excellente dégustation !', 20, 288);
  doc.text('integral.muse.site', 20, 293);

  doc.save('facture-integral-' + num + '.pdf');
  showToast('Facture PDF générée !', 'gold');
}

// ══ IMPRESSION THERMIQUE ════════════════════════
function printThermal(){
  if(!cart.length){ showToast('Panier vide !','red'); return; }
  const total = cart.reduce((s,i) => s+i.prix*i.qty, 0);
  const now = new Date();
  const dateStr = now.toLocaleDateString('fr-FR') + ' ' + now.toLocaleTimeString('fr-FR',{hour:'2-digit',minute:'2-digit'});
  const num = 'INT-' + Date.now().toString().slice(-6);

  const printArea = document.getElementById('printArea');
  printArea.innerHTML = `
    <div style="text-align:center;font-family:monospace;font-size:11pt;padding:3mm 0">
      <div style="font-size:15pt;font-weight:bold;letter-spacing:2px">INTEGRAL</div>
      <div style="font-size:8pt">Ouagadougou, Burkina Faso</div>
      <div style="font-size:8pt">+${CONFIG.waNumber}</div>
      <div style="border-top:1px dashed #000;margin:4mm 0"></div>
      <div style="font-size:8pt">N° ${num}</div>
      <div style="font-size:8pt">${dateStr}</div>
      ${tableLabel ? `<div style="font-size:8pt;font-weight:bold">${tableLabel}</div>` : ''}
      <div style="border-top:1px dashed #000;margin:4mm 0"></div>
      ${cart.map(it => `
        <div style="display:flex;justify-content:space-between;font-size:9pt;margin:2mm 0">
          <span>${it.nom.slice(0,22)}</span>
          <span>x${it.qty}</span>
          <span>${(it.prix*it.qty).toLocaleString('fr-FR')}</span>
        </div>`).join('')}
      <div style="border-top:1px dashed #000;margin:4mm 0"></div>
      <div style="font-size:12pt;font-weight:bold">TOTAL: ${total.toLocaleString('fr-FR')} FCFA</div>
      <div style="border-top:1px dashed #000;margin:4mm 0"></div>
      <div style="font-size:8pt">Merci de votre visite !</div>
      <div style="font-size:7pt">integral.muse.site</div>
    </div>`;
  printArea.style.display = 'block';
  window.print();
  printArea.style.display = 'none';
  showToast('Impression en cours…', 'gold');
}

// ══ RENDU MENU ═══════════════════════════════════
function slug(s){ return s.replace(/[^a-z0-9]/gi,'_'); }

window.renderMenu = function(filter){
  filter = (filter||'').toLowerCase().trim();
  const cats    = [...new Set(window.MENU.map(i => i.cat))];
  const nav     = document.getElementById('nav');
  const content = document.getElementById('menuContent');
  const noRes   = document.getElementById('noResult');

  const activeCat = nav.querySelector('.ntab.active')?.textContent?.trim() || null;
  const navNeedsRebuild = nav.children.length !== cats.length;

  if(navNeedsRebuild){
    nav.innerHTML = '';
    cats.forEach((cat, idx) => {
      const t = document.createElement('div');
      t.className = 'ntab' + ((cat === activeCat || (!activeCat && idx===0)) ? ' active' : '');
      t.textContent = cat;
      t.onclick = () => {
        document.querySelectorAll('.ntab').forEach(x => x.classList.remove('active'));
        t.classList.add('active');
        const target = document.getElementById('sec-' + slug(cat));
        if(target){
          const offset = document.getElementById('navWrapper').offsetHeight + 56 + (document.getElementById('tableBanner').classList.contains('show') ? document.getElementById('tableBanner').offsetHeight : 0);
          window.scrollTo({top: target.offsetTop - offset - 16, behavior:'smooth'});
        }
      };
      nav.appendChild(t);
    });
  }

  content.innerHTML = '';
  let totalShown = 0;

  cats.forEach(cat => {
    const items = window.MENU.filter(i =>
      i.cat === cat &&
      i.dispo !== false &&
      (!filter || i.nom.toLowerCase().includes(filter) || cat.toLowerCase().includes(filter))
    );
    if(!items.length) return;
    totalShown += items.length;

    const sec = document.createElement('div');
    sec.className = 'section';
    sec.id = 'sec-' + slug(cat);

    const head = document.createElement('div');
    head.className = 'section-head';
    head.innerHTML = `
      <div class="section-accent"></div>
      <div class="section-title">${cat}</div>
      <div class="section-count">${items.length} plat${items.length>1?'s':''}</div>`;

    const grid = document.createElement('div');
    grid.className = 'grid';

    items.forEach(item => {
      const imgUrl  = getItemImageUrl(item);
      const inCart  = cart.find(i => i.nom === item.nom);
      const qtyVal  = inCart ? inCart.qty : 0;
      const nomEsc  = item.nom.replace(/'/g,"&#39;").replace(/"/g,"&quot;");
      const div = document.createElement('div');
      div.className = 'card' + (item.dispo===false?' unavailable':'');
      div.dataset.nom = item.nom;
      div.innerHTML = `
        <div class="card-img-wrap">
          <img class="card-img" src="${imgUrl}" alt="${nomEsc}" loading="lazy"
               onerror="this.style.display='none';this.nextElementSibling.style.display='flex'"/>
          <div class="card-img-fallback" style="display:none">
            <img src="https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=60&h=60&fit=crop" alt="" style="width:50px;height:50px;object-fit:cover;border-radius:8px;opacity:.4"/>
          </div>
          ${item.dispo===false?'<div class="card-unavail-badge">Indisponible</div>':''}
        </div>
        <div class="card-body">
          <div class="card-name">${item.nom}</div>
          <div class="card-bottom">
            ${item.prixLabel
              ? `<div class="card-price"><span class="card-price-variable">${item.prixLabel}</span></div>`
              : `<div class="card-price">${item.prix > 0 ? item.prix.toLocaleString('fr-FR')+' F CFA' : '—'}</div>`}
            ${item.prix > 0 ? `
              <button class="btn-add" data-nom="${nomEsc}" onclick="addToCart('${item.nom.replace(/'/g,"\\'")}',${item.prix})" title="Ajouter" ${qtyVal>0?'style="display:none"':''}>
                <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" fill="currentColor"/></svg>
              </button>
              <div class="card-qty-ctrl" ${qtyVal>0?'':'style="display:none"'}>
                <button onclick="cartChangeFromCard('${item.nom.replace(/'/g,"\\'")}', -1)">−</button>
                <span class="cq-val">${qtyVal}</span>
                <button onclick="cartChangeFromCard('${item.nom.replace(/'/g,"\\'")}', 1)">+</button>
              </div>` : ''}
          </div>
        </div>`;
      grid.appendChild(div);
    });

    sec.appendChild(head);
    sec.appendChild(grid);
    content.appendChild(sec);
  });

  noRes.style.display = totalShown === 0 ? 'block' : 'none';
};

function cartChangeFromCard(nom, delta){
  const idx = cart.findIndex(i => i.nom === nom);
  if(delta > 0){
    if(idx >= 0){ cart[idx].qty++; }
    else {
      const item = window.MENU.find(i => i.nom === nom);
      if(item) addToCart(nom, item.prix);
      return;
    }
  } else if(idx >= 0){
    cart[idx].qty += delta;
    if(cart[idx].qty <= 0) cart.splice(idx,1);
  }
  updateCartUI();
  updateCardQtyDisplay(nom);
}

// ══ DARK MODE ════════════════════════════════════
function toggleDark(){
  const html = document.documentElement;
  const isDark = html.dataset.theme === 'dark';
  html.dataset.theme = isDark ? 'light' : 'dark';
  localStorage.setItem('theme', html.dataset.theme);
  document.getElementById('darkIcon').innerHTML = isDark
    ? '<path d="M12 3a9 9 0 100 18A9 9 0 0012 3zm0 2a7 7 0 010 14V5z"/>'
    : '<path d="M12 2a10 10 0 00-7.35 16.83A10 10 0 1012 2z"/>';
}
// Restore theme
const savedTheme = localStorage.getItem('theme');
if(savedTheme){ document.documentElement.dataset.theme = savedTheme; }

// ══ QR CODE ══════════════════════════════════════
function showQR(){
  const modal = document.getElementById('qrModal');
  const container = document.getElementById('qrCanvas');
  const url = window.location.href.split('?')[0];
  container.innerHTML = '';
  document.getElementById('qrUrl').textContent = url;
  modal.classList.add('open');
  setTimeout(() => {
    if(window.QRCode){
      new QRCode(container, {
        text: url,
        width: 220,
        height: 220,
        colorDark: '#1A6B3C',
        colorLight: '#ffffff',
        correctLevel: QRCode.CorrectLevel.H
      });
    } else {
      container.innerHTML = `<img src="https://api.qrserver.com/v1/create-qr-code/?size=220x220&data=${encodeURIComponent(url)}&color=1A6B3C" alt="QR Code" style="width:220px;height:220px"/>`;
    }
  }, 100);
}
document.getElementById('qrModal').addEventListener('click', e => {
  if(e.target === document.getElementById('qrModal')) document.getElementById('qrModal').classList.remove('open');
});

// ══ ADMIN ════════════════════════════════════════
let adminLoggedIn = false;
let ordersUnsub = null;

// ── Géolocalisation : ouvre l'app Maps native sur mobile ──
function openInMaps(e){
  e.preventDefault();
  const lat = 12.327382;
  const lng = -1.55043;
  const label = encodeURIComponent('Restaurant Intégral — Cissin, Ouagadougou');
  const isIOS     = /iPad|iPhone|iPod/.test(navigator.userAgent);
  const isAndroid = /Android/.test(navigator.userAgent);

  let url;
  if(isIOS){
    // Apple Maps (natif iOS)
    url = `maps://maps.apple.com/?q=${label}&ll=${lat},${lng}`;
  } else if(isAndroid){
    // Google Maps app Android
    url = `geo:${lat},${lng}?q=${lat},${lng}(${label})`;
  } else {
    // Navigateur desktop → Google Maps web
    url = `https://www.google.com/maps?q=${lat},${lng}`;
  }
  window.open(url, '_blank');
}

function openAdmin(){
  document.getElementById('adminModal').classList.add('open');
  if(adminLoggedIn) renderStats();
}

/* ── Accès admin secret : appui long (2s) sur le logo ── */
(function setupSecretAdmin(){
  let pressTimer = null;
  const brand = document.querySelector('.topbar-brand');
  if(!brand) return;

  function startPress(e){
    pressTimer = setTimeout(() => {
      const btn = document.getElementById('adminBtn');
      if(!btn) return;
      const isVisible = btn.style.width !== '0px' && btn.style.opacity !== '0';
      if(isVisible){
        // Cacher à nouveau
        btn.style.cssText = 'opacity:0;pointer-events:none;width:0;padding:0;border:none;overflow:hidden;margin:0';
      } else {
        // Révéler le bouton admin
        btn.style.cssText = 'opacity:1;pointer-events:all;width:38px;overflow:visible;margin:0';
        showToast('🔓 Accès admin déverrouillé', 1800);
      }
    }, 2000);
  }

  function cancelPress(){ clearTimeout(pressTimer); }

  brand.addEventListener('mousedown',  startPress);
  brand.addEventListener('touchstart', startPress, { passive: true });
  brand.addEventListener('mouseup',    cancelPress);
  brand.addEventListener('mouseleave', cancelPress);
  brand.addEventListener('touchend',   cancelPress);
})();

function closeAdmin(){
  document.getElementById('adminModal').classList.remove('open');
  document.getElementById('adminModal').classList.remove('fullscreen');
}

function toggleFullscreen(){
  document.getElementById('adminModal').classList.toggle('fullscreen');
}

function doLogin(){
  const u = document.getElementById('loginUser').value.trim();
  const p = document.getElementById('loginPass').value;
  if(u === CONFIG.adminUser && p === CONFIG.adminPass){
    adminLoggedIn = true;
    document.getElementById('loginBox').style.display = 'none';
    document.getElementById('adminDash').style.display = 'block';
    renderStats();
    startOrdersListener();
  } else {
    document.getElementById('loginErr').style.display = 'block';
    setTimeout(() => document.getElementById('loginErr').style.display='none', 3000);
  }
}

function doLogout(){
  adminLoggedIn = false;
  if(ordersUnsub){ ordersUnsub(); ordersUnsub=null; }
  document.getElementById('adminDash').style.display = 'none';
  document.getElementById('loginBox').style.display = 'block';
  document.getElementById('loginUser').value = '';
  document.getElementById('loginPass').value = '';
  closeAdmin();
}

function switchTab(tab, el){
  document.querySelectorAll('.atab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  ['stats','orders','menu','config'].forEach(t => {
    const el2 = document.getElementById('tab-'+t);
    if(el2) el2.style.display = t===tab ? 'block' : 'none';
  });
  if(tab === 'menu') window.renderMenuEditor();
  if(tab === 'stats') renderStats();
}

// ── Stats
let allOrders = [];
function startOrdersListener(){
  if(!window.fbListenOrders) return;
  ordersUnsub = window.fbListenOrders(orders => {
    allOrders = orders;
    renderOrders(orders);
    renderStats();
  });
}

function renderStats(){
  const total = allOrders.reduce((s,o) => s + (o.total||0), 0);
  const avg   = allOrders.length ? Math.round(total/allOrders.length) : 0;
  document.getElementById('st-orders').textContent = allOrders.length;
  document.getElementById('st-ca').textContent     = total > 0 ? total.toLocaleString('fr-FR') : '0';
  document.getElementById('st-avg').textContent    = avg > 0 ? avg.toLocaleString('fr-FR') : '0';
  document.getElementById('st-items').textContent  = window.MENU.length;

  // Top items
  const itemCount = {};
  allOrders.forEach(o => {
    (o.items||[]).forEach(it => {
      itemCount[it.nom] = (itemCount[it.nom]||0) + (it.qty||1);
    });
  });
  const sorted = Object.entries(itemCount).sort((a,b)=>b[1]-a[1]).slice(0,8);
  const maxVal = sorted[0]?.[1] || 1;
  document.getElementById('topChart').innerHTML = sorted.length
    ? sorted.map(([nom,cnt],i) => `
        <div class="bar-row">
          <div class="bar-label" title="${nom}">${nom.slice(0,22)}</div>
          <div class="bar-track">
            <div class="bar-fill ${i<3?'gold':''}" style="width:${Math.round(cnt/maxVal*100)}%">${cnt}</div>
          </div>
        </div>`).join('')
    : '<p style="color:var(--muted);font-size:.85rem;text-align:center;padding:16px">Aucune commande encore</p>';
}

function renderOrders(orders){
  const tbody = document.getElementById('ordersBody');
  if(!tbody) return;
  if(!orders.length){
    tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:24px;color:var(--muted)">Aucune commande</td></tr>';
    return;
  }
  tbody.innerHTML = orders.map((o,i) => {
    const d = o.createdAt?.seconds ? new Date(o.createdAt.seconds*1000) : null;
    const heure = d ? d.toLocaleTimeString('fr-FR',{hour:'2-digit',minute:'2-digit'}) + ' ' + d.toLocaleDateString('fr-FR') : '—';
    const plats = (o.items||[]).map(it=>`${it.nom} x${it.qty}`).join(', ');
    return `<tr>
      <td>#${orders.length-i}</td>
      <td>${o.table||'—'}</td>
      <td>${heure}</td>
      <td style="max-width:220px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap" title="${plats}">${plats}</td>
      <td style="font-weight:700;color:var(--g)">${(o.total||0).toLocaleString('fr-FR')} F</td>
      <td>${o.note||'—'}</td>
    </tr>`;
  }).join('');
}

// ── Menu Editor
window.renderMenuEditor = function(){
  const container = document.getElementById('menuEditorList');
  if(!container) return;
  container.innerHTML = window.MENU.map((item,idx) => `
    <div class="me-item">
      <img class="me-thumb" src="${getItemImageUrl(item)}" alt="${item.nom}" loading="lazy"
           onerror="this.src='https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=80&h=80&fit=crop'"/>
      <div class="me-info">
        <div class="me-name" title="${item.nom}">${item.nom}</div>
        <div class="me-cat">${item.cat}</div>
      </div>
      <div class="me-price">${item.prix>0?item.prix.toLocaleString('fr-FR')+' F':'Var.'}</div>
      <div class="me-actions">
        <button class="btn-sm btn-edit" data-idx="${idx}">
          <svg viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04a1 1 0 000-1.41l-2.34-2.34a1 1 0 00-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" fill="currentColor"/></svg>
          Modifier
        </button>
        <button class="btn-sm btn-del" data-idx="${idx}">
          <svg viewBox="0 0 24 24"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z" fill="currentColor"/></svg>
        </button>
      </div>
    </div>`).join('');
};

document.addEventListener('click', e => {
  const editBtn = e.target.closest('.btn-edit[data-idx]');
  const delBtn  = e.target.closest('.btn-del[data-idx]');
  if(editBtn) editItem(parseInt(editBtn.dataset.idx));
  if(delBtn)  deleteItem(parseInt(delBtn.dataset.idx));
});

let currentDispoState = true;
function toggleDispoForm(){
  currentDispoState = !currentDispoState;
  const tog = document.getElementById('ef-dispo-toggle');
  const lbl = document.getElementById('ef-dispo-label');
  tog.classList.toggle('active', currentDispoState);
  lbl.textContent = currentDispoState ? 'Disponible' : 'Indisponible';
}

function showEditForm(){
  currentDispoState = true;
  document.getElementById('editForm').classList.add('show');
  document.getElementById('ef-idx').value   = '';
  document.getElementById('ef-name').value  = '';
  document.getElementById('ef-price').value = '';
  document.getElementById('ef-img').value   = '';
  previewImg('');
  document.getElementById('ef-dispo-toggle').classList.add('active');
  document.getElementById('ef-dispo-label').textContent = 'Disponible';
  setTimeout(() => document.getElementById('ef-name').focus(), 50);
}

function editItem(idx){
  const it = window.MENU[idx];
  if(!it) return;
  currentDispoState = it.dispo !== false;
  document.getElementById('editForm').classList.add('show');
  document.getElementById('ef-idx').value   = idx;
  document.getElementById('ef-name').value  = it.nom;
  document.getElementById('ef-price').value = it.prix;
  document.getElementById('ef-cat').value   = it.cat;
  document.getElementById('ef-img').value   = it.img || '';
  previewImg(it.img || '');
  const tog = document.getElementById('ef-dispo-toggle');
  tog.classList.toggle('active', currentDispoState);
  document.getElementById('ef-dispo-label').textContent = currentDispoState ? 'Disponible' : 'Indisponible';
  document.getElementById('editForm').scrollIntoView({behavior:'smooth', block:'start'});
}

function cancelEdit(){ document.getElementById('editForm').classList.remove('show'); }

function previewImg(url){
  const prev = document.getElementById('ef-preview');
  if(url){ prev.src=url; prev.classList.add('show'); prev.onerror=()=>{prev.classList.remove('show');prev.src=''}; }
  else { prev.classList.remove('show'); prev.src=''; }
}

async function saveItem(){
  const idx  = document.getElementById('ef-idx').value;
  const nom  = document.getElementById('ef-name').value.trim();
  const prix = parseInt(document.getElementById('ef-price').value) || 0;
  const cat  = document.getElementById('ef-cat').value;
  const img  = document.getElementById('ef-img').value.trim();
  const dispo= currentDispoState;

  if(!nom){ showToast('Le nom est obligatoire !','red'); return; }

  const saveBtn = document.querySelector('#editForm .btn-primary');
  saveBtn.textContent = 'Enregistrement…'; saveBtn.disabled = true;

  const i = idx !== '' ? parseInt(idx) : -1;
  if(i >= 0 && window.MENU[i]){
    window.MENU[i] = { ...window.MENU[i], nom, prix, cat, img, dispo };
  } else {
    window.MENU.push({ cat, nom, prix, img, dispo });
  }

  try {
    if(window.fbSaveItem){
      const key = (cat+'_'+nom).replace(/[^a-z0-9]/gi,'_').toLowerCase();
      await window.fbSaveItem({ _key:key, prix, img, cat, nom, dispo });
    }
    showToast('Enregistré avec succès !','green');
  } catch(e){
    showToast('Enregistré en local','');
  } finally {
    saveBtn.textContent = 'Enregistrer'; saveBtn.disabled = false;
  }

  window.renderMenuEditor();
  window.renderMenu(document.getElementById('searchInput').value);
  cancelEdit();
}

async function deleteItem(idx){
  const it = window.MENU[idx];
  if(!it) return;
  if(!confirm('Supprimer "' + it.nom + '" du menu ?')) return;
  const key = (it.cat+'_'+it.nom).replace(/[^a-z0-9]/gi,'_').toLowerCase();
  if(window.fbDeleteItem) await window.fbDeleteItem(key);
  window.MENU.splice(idx, 1);
  window.renderMenuEditor();
  window.renderMenu(document.getElementById('searchInput').value);
  showToast('Plat supprimé', '');
}

function saveConfig(){
  const p1 = document.getElementById('cfg-pass').value;
  const p2 = document.getElementById('cfg-pass2').value;
  if(p1 && p1 !== p2){ showToast('Les mots de passe ne correspondent pas','red'); return; }
  if(p1) CONFIG.adminPass = p1;
  CONFIG.waNumber = document.getElementById('cfg-wa').value.replace(/[\s+]/g,'');
  showToast('Configuration enregistrée !','green');
}

// ══ TOAST ════════════════════════════════════════
function showToast(msg, type){
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = '';
  t.classList.add('show');
  if(type) t.classList.add(type);
  clearTimeout(t._t);
  t._t = setTimeout(() => t.classList.remove('show'), 2800);
}
window.showToast = showToast;

// ══ SEARCH ═══════════════════════════════════════
document.getElementById('searchInput').addEventListener('input', e => {
  window.renderMenu(e.target.value.toLowerCase().trim());
  updateAllCardQtyDisplays();
});

// ══ SCROLL TOP ═══════════════════════════════════
window.addEventListener('scroll', () => {
  document.getElementById('scrollTop').classList.toggle('show', window.scrollY > 400);
  // Update active nav tab based on scroll position
  const cats = [...document.querySelectorAll('.section')];
  const scrollY = window.scrollY + 160;
  cats.forEach(sec => {
    if(sec.offsetTop <= scrollY && (sec.offsetTop + sec.offsetHeight) > scrollY){
      const id = sec.id.replace('sec-','');
      document.querySelectorAll('.ntab').forEach(t => {
        t.classList.toggle('active', slug(t.textContent.trim()) === id);
      });
    }
  });
});

// ══ KEYBOARD SHORTCUTS ═══════════════════════════
document.addEventListener('keydown', e => {
  if(e.key === 'Escape'){
    const modal = document.getElementById('adminModal');
    const qr    = document.getElementById('qrModal');
    if(modal.classList.contains('fullscreen')){ toggleFullscreen(); e.stopPropagation(); }
    else if(modal.classList.contains('open')){ closeAdmin(); }
    else if(qr.classList.contains('open')){ qr.classList.remove('open'); }
  }
  if(e.key === 'f' || e.key === 'F'){
    const modal = document.getElementById('adminModal');
    if(modal.classList.contains('open') && document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA'){
      toggleFullscreen();
    }
  }
});

// ══ SALON MODAL ══════════════════════════════════
function openSalonModal(){
  const m = document.getElementById('salonModal');
  m.style.display = 'flex';
  // Set min date to today
  const today = new Date().toISOString().split('T')[0];
  document.getElementById('sr-date').min = today;
  document.body.style.overflow = 'hidden';
}
function closeSalonModal(){
  document.getElementById('salonModal').style.display = 'none';
  document.body.style.overflow = '';
}
function submitSalonReservation(){
  const nom     = document.getElementById('sr-nom').value.trim();
  const tel     = document.getElementById('sr-tel').value.trim();
  const date    = document.getElementById('sr-date').value;
  const heure   = document.getElementById('sr-heure').value;
  const nbr     = document.getElementById('sr-nbr').value;
  const occasion= document.getElementById('sr-occasion').value;
  const msg     = document.getElementById('sr-message').value.trim();

  if(!nom || !tel || !date || !heure || !nbr){
    showToast('Veuillez remplir tous les champs obligatoires (*)', 'red');
    return;
  }

  const dateF = new Date(date).toLocaleDateString('fr-FR',{weekday:'long',day:'numeric',month:'long',year:'numeric'});
  const lines = [
    '🍽️ *RÉSERVATION SALON — Integral Restaurant Bar & Café*',
    '━━━━━━━━━━━━━━━━━━━━━━━━',
    `👤 *Nom :* ${nom}`,
    `📞 *Téléphone :* ${tel}`,
    `📅 *Date :* ${dateF}`,
    `🕐 *Heure :* ${heure}`,
    `👥 *Personnes :* ${nbr}`,
    occasion ? `🎉 *Occasion :* ${occasion}` : '',
    msg ? `💬 *Message :* ${msg}` : '',
    '━━━━━━━━━━━━━━━━━━━━━━━━',
    '_Merci de confirmer cette réservation_ 🙏'
  ].filter(Boolean).join('\n');

  const waNumber = (window.CONFIG && CONFIG.waNumber) || '22654470091';
  const waUrl = `https://wa.me/${waNumber}?text=${encodeURIComponent(lines)}`;
  window.open(waUrl, '_blank');
  closeSalonModal();
  showToast('Redirection WhatsApp...', 'green');
}
// Fermer le modal en cliquant sur le fond
document.getElementById('salonModal').addEventListener('click', function(e){
  if(e.target === this) closeSalonModal();
});

// ══ HERO SLIDESHOW ═══════════════════════════
(function(){
  let current = 0;
  const slides = document.querySelectorAll('.hero-slide');
  const dots   = document.querySelectorAll('.hero-dot');
  const total  = slides.length;
  function goSlide(n){
    slides[current].classList.remove('active');
    dots[current].classList.remove('active');
    current = (n % total + total) % total;
    slides[current].classList.add('active');
    dots[current].classList.add('active');
  }
  window.goSlide = goSlide;
  setInterval(() => goSlide(current + 1), 3000);
})();

// ══ QUICK-NAV PANEL ══════════════════════════
const CAT_META = {
  'Petit-Déjeuner':       { emoji:'🌅', label:'Petit-Déjeuner'     },
  'Entrées froides':      { emoji:'🥗', label:'Entrées froides'     },
  'Entrées chaudes':      { emoji:'🥘', label:'Entrées chaudes'     },
  'Plats chauds':         { emoji:'🍽️', label:'Plats chauds'        },
  'Fast food':            { emoji:'🍔', label:'Fast food'           },
  'Grillades':            { emoji:'🔥', label:'Grillades'           },
  'Nos Pizzas':           { emoji:'🍕', label:'Nos Pizzas'          },
  'Accompagnements':      { emoji:'🍟', label:'Accompagnements'     },
  'Nos Desserts':         { emoji:'🍮', label:'Nos Desserts'        },
  'Jus':                  { emoji:'🥤', label:'Jus frais'           },
  'Boissons chaudes':     { emoji:'☕', label:'Boissons chaudes'    },
  'Sucreries':            { emoji:'🥤', label:'Sucreries'           },
  'Bières':               { emoji:'🍺', label:'Bières'              },
  'Cocktails Sans Alcool':{ emoji:'🍹', label:'Cocktails S.A.'      },
  'Cocktails Alcoolisés': { emoji:'🍸', label:'Cocktails Alco.'     },
  'Nos Vins':             { emoji:'🍷', label:'Nos Vins'            },
  'Champagnes':           { emoji:'🍾', label:'Champagnes'          },
  'Liqueurs':             { emoji:'🥃', label:'Liqueurs'            },
  'Whiskys':              { emoji:'🥃', label:'Whiskys'             },
  'Rhums':                { emoji:'🥃', label:'Rhums'               },
  'Cognacs':              { emoji:'✨', label:'Cognacs'             },
};

function buildQuickNav(){
  const grid = document.getElementById('qnpGrid');
  if(!grid || grid.children.length > 0) return;
  // Compter les plats par catégorie
  const counts = {};
  window.MENU.forEach(it => { counts[it.cat] = (counts[it.cat]||0) + 1; });
  // Ordre exact du menu
  const cats = [...new Set(window.MENU.map(it => it.cat))];
  cats.forEach(cat => {
    const meta  = CAT_META[cat] || { emoji:'📋', label: cat };
    const count = counts[cat] || 0;
    const chip  = document.createElement('button');
    chip.className = 'qnp-chip';
    chip.setAttribute('aria-label', `Aller à la catégorie ${cat}`);
    chip.innerHTML = `
      <span class="qnp-chip-emoji">${meta.emoji}</span>
      <span class="qnp-chip-label">${meta.label}</span>
      <span class="qnp-chip-count">${count}</span>`;
    chip.addEventListener('click', () => {
      closeQuickNav();
      // Activer l'onglet nav correspondant
      document.querySelectorAll('.ntab').forEach(t => {
        if(slug(t.textContent.trim()) === slug(cat)){
          t.click();
          setTimeout(() => {
            const sec = document.getElementById('sec-' + slug(cat));
            if(sec){
              const offset = 56 + 50; // topbar + nav
              window.scrollTo({ top: sec.offsetTop - offset, behavior: 'smooth' });
            }
          }, 60);
        }
      });
    });
    grid.appendChild(chip);
  });
}

function toggleQuickNav(){
  const panel = document.getElementById('quickNavPanel');
  const btn   = document.getElementById('heroExploreBtn');
  const ov    = document.getElementById('qnpOverlay');
  const isOpen = panel.classList.contains('open');
  if(isOpen){ closeQuickNav(); }
  else {
    buildQuickNav();
    panel.classList.add('open');
    btn.classList.add('open');
    btn.setAttribute('aria-expanded','true');
    ov.classList.add('show');
  }
}

function closeQuickNav(){
  document.getElementById('quickNavPanel').classList.remove('open');
  document.getElementById('heroExploreBtn').classList.remove('open');
  document.getElementById('heroExploreBtn').setAttribute('aria-expanded','false');
  document.getElementById('qnpOverlay').classList.remove('show');
}
window.toggleQuickNav = toggleQuickNav;
window.closeQuickNav  = closeQuickNav;

// Fermer avec Escape
document.addEventListener('keydown', e => {
  if(e.key === 'Escape') closeQuickNav();
});

// ══ LOADER & INIT ════════════════════════════════
window.addEventListener('load', () => {
  setTimeout(() => document.getElementById('loader').classList.add('hide'), 1600);
  window.renderMenu();
});
</script>
</body>
</html>
